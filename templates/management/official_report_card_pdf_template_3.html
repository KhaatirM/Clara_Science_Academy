<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>3rd Grade Progress Report - Clara Science Academy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='report_card_styles.css', _external=True) }}">
</head>
<body>
    {% include 'management/_report_card_header.html' %}

    <p class="report-period-line"><strong>Report Period:</strong> {{ report_card.quarter }} - {{ generated_date.strftime('%B %d, %Y') if generated_date else 'N/A' }}</p>

    <div class="section-title">ATTENDANCE:</div>
    <table>
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>1st Q</th>
                <th>2nd Q</th>
                <th>3rd Q</th>
                <th>4th Q</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>Excused Absences</td><td></td><td></td><td></td><td></td></tr>
            <tr><td>Unexcused Absences</td><td></td><td></td><td></td><td></td></tr>
        </tbody>
    </table>

    <div class="section-title">Academic Standards:</div>
    <p>The Clara Science Academy (CSA) reports student performance quarterly. This 3rd grade progress report lists the skills outlined by the NC Department of Education Standards. This framework provides guidance about what a 3rd grade student should know or be able to do. The K12 curriculum is the core set of courses used by CSA to help 3rd grade students meet these standards. Individualized goals are set for each student. The teacher and learning coach determine the percentage of course completion necessary to meet the academic goals for the second-grade student based on the standards and anchors. The year-to-date course progress reflects the progress towards meeting standards as well as academic goals related to course completion. The decision to promote a student to the next level is determined by the teacher.</p>

    <div class="section-title">Year-to-date Course Progress:</div>
    <table>
        <thead>
            <tr>
                <th>Course</th>
                <th>Quarter Grade</th>
                <th>Comments</th>
            </tr>
        </thead>
        <tbody>
            {% if class_objects %}
                {% for class_obj in class_objects %}
                    {% set class_grade = grades.get(class_obj.name, {}) if grades else {} %}
                    {% set letter_grade = class_grade.get('letter', 'N/A') if class_grade else 'N/A' %}
                    {% set percentage = class_grade.get('percentage', class_grade.get('average', 0)) if class_grade else 0 %}
                    <tr>
                        <td>{{ class_obj.name }} ({{ class_obj.subject or 'N/A' }})</td>
                        <td>{{ letter_grade }} ({{ "%.1f"|format(percentage) }}%)</td>
                        <td>{% if include_comments and class_grade.get('comments') %}{{ class_grade.get('comments', '')|nl2br }}{% else %}N/A{% endif %}</td>
                    </tr>
                {% endfor %}
            {% else %}
                {% if grades %}
                    {% for subject, grade_info in grades.items() %}
                        {% if grade_info is mapping %}
                            {% set letter_grade = grade_info.get('letter', 'N/A') %}
                            {% set percentage = grade_info.get('percentage', grade_info.get('average', 0)) %}
                        {% else %}
                            {% set letter_grade = 'N/A' %}
                            {% set percentage = grade_info if grade_info is number else 0 %}
                        {% endif %}
                        <tr>
                            <td>{{ subject }}</td>
                            <td>{{ letter_grade }} ({{ "%.1f"|format(percentage) }}%)</td>
                            <td>{% if include_comments and grade_info.get('comments') %}{{ grade_info.get('comments', '')|nl2br }}{% else %}N/A{% endif %}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="3" style="text-align: center; padding: 15px; color: #666;">No grade data available</td></tr>
                {% endif %}
            {% endif %}
        </tbody>
    </table>

    <div class="section-title">Assignment Grades ({{ report_card.quarter }}):</div>
    {% if grades %}
        {% set has_assignments = false %}
        {% for subject, grade_info in grades.items() %}
            {% if grade_info is mapping and grade_info.get('assignments') %}
                {% set has_assignments = true %}
                {% break %}
            {% endif %}
        {% endfor %}
        {% if has_assignments %}
            <table>
                <thead>
                    <tr>
                        <th>Subject/Course</th>
                        <th>Assignment Title</th>
                        <th>Grade</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject, grade_info in grades.items() %}
                        {% if grade_info is mapping and grade_info.get('assignments') %}
                            {% for assignment in grade_info.get('assignments', []) %}
                                <tr>
                                    <td>{{ subject }}</td>
                                    <td>{{ assignment.get('title', 'N/A') }}</td>
                                    <td>{{ assignment.get('grade', 'N/A') }}</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No individual assignment grades recorded for this quarter.</p>
        {% endif %}
    {% else %}
        <p>No individual assignment grades recorded for this quarter.</p>
    {% endif %}

    <div class="section-title">Teacher Comments:</div>
    <div class="comments-box">
        <p>{% if include_comments and grades %}{{ grades.get('comments', 'N/A')|nl2br }}{% else %}N/A{% endif %}</p>
    </div>

    <div class="footer">
        <p>Parent Signature: ___________________________________ Date: _________________</p>
        <p>Academy Director: ___________________________________ Date: _________________</p>
    </div>
</body>
</html>
