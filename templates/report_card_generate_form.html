{% extends "dashboard_layout.html" %}

{% block dashboard_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Generate New Report Card</h3>
    {# FIX: Correctly use role_prefix with dashboard_section #}
    <a href="{{ url_for(role_prefix ~ 'dashboard_section', section='report_cards') }}" class="btn btn-outline-secondary btn-sm">Back to Report Cards List</a>
  </div>

  <form method="POST" action="{{ form_action }}" class="needs-validation" novalidate>
        { csrf_token() }
    <div class="row g-3">
      <div class="col-md-6">
        <label for="student_id" class="form-label">Select Student <span class="text-danger">*</span></label>
        <select class="form-select" id="student_id" name="student_id" required>
          <option value="">Choose Student...</option>
          {% for student in all_students %}
            <option value="{{ student.id }}" {% if selected_student_id == student.id %}selected{% endif %}>{{ student.name }} (ID: {{ student.student_id_formatted }})</option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">Please select a student.</div>
      </div>

      <div class="col-md-6">
        <label for="class_id" class="form-label">Select Class <span class="text-danger">*</span></label>
        <select class="form-select" id="class_id" name="class_id" required>
          <option value="">Choose Class...</option>
          {% for class_item in all_classes %}
            <option value="{{ class_item.id }}" {% if selected_class_id == class_item.id %}selected{% endif %}>{{ class_item.name }} ({{ class_item.subject }})</option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">Please select a class.</div>
      </div>

      <div class="col-md-6">
        <label for="school_year" class="form-label">School Year <span class="text-danger">*</span></label>
        <select class="form-select" id="school_year" name="school_year" required>
          <option value="">Choose School Year...</option>
          {% for year in school_years %}
            <option value="{{ year }}" {% if selected_school_year == year %}selected{% endif %}>{{ year }}</option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">Please select a school year.</div>
      </div>

      <div class="col-md-6">
        <label for="quarter" class="form-label">Quarter <span class="text-danger">*</span></label>
        <select class="form-select" id="quarter" name="quarter" required>
          <option value="">Choose Quarter...</option>
          {% for q in quarters %}
            <option value="{{ q }}" {% if selected_quarter == q %}selected{% endif %}>{{ q }}</option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">Please select a quarter.</div>
      </div>

      <div class="col-12">
        <label for="comments" class="form-label">Comments (Optional)</label>
        <textarea class="form-control" id="comments" name="comments" rows="3"></textarea>
      </div>
    </div>

    <hr class="my-4">

    <button class="btn btn-primary btn-lg" type="submit">Generate Report Card</button>
    {# FIX: Correctly use role_prefix with dashboard_section for the cancel button #}
    <a href="{{ url_for(role_prefix ~ 'dashboard_section', section='report_cards') }}" class="btn btn-secondary btn-lg ms-2" role="button">
      Cancel
    </a>
  </form>

<script>
// Bootstrap validation script
(function () { 'use strict'; var forms = document.querySelectorAll('.needs-validation'); Array.prototype.slice.call(forms).forEach(function (form) { form.addEventListener('submit', function (event) { if (!form.checkValidity()) { event.preventDefault(); event.stopPropagation(); } form.classList.add('was-validated'); } , false); }); })();
</script>
{% endblock %}