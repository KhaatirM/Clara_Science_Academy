{% extends "dashboard_layout.html" %}

{% block dashboard_content %}
    {% if form_type == 'assignment_submission' %}
        <!-- Assignment Submission Form -->
        <h2 class="mb-4">Submit Assignment</h2>
        <div class="card shadow-sm">
            <div class="card-header">
                <h4>{{ assignment.title }}</h4>
                <h6 class="text-muted">{{ assignment.class_info.name }} | Due: {{ assignment.due_date.strftime('%A, %B %d, %Y') }}</h6>
            </div>
            <div class="card-body">
                <!-- Assignment Details -->
                <h5>Description</h5>
                <p>{{ assignment.description|nl2br|safe }}</p>
                {% if assignment.attached_file_path %}
                <div class="mb-3">
                    <strong>Attachment:</strong>
                    <a href="{{ url_for('static', filename='uploads/' + assignment.attached_file_path) }}" target="_blank">
                        <i class="bi bi-paperclip"></i> {{ assignment.attached_file_path|regex_replace('^assign_attach_\\d+_', '') }}
                    </a>
                </div>
                {% endif %}
                <hr>
                <!-- Submission Form -->
                <form method="POST" enctype="multipart/form-data">
        { csrf_token() }
                    <h5>Your Submission</h5>
                    <!-- Display existing submission if it exists -->
                    {% if submission %}
                        <div class="alert alert-info">
                            <p class="mb-1"><strong>You submitted on:</strong> {{ submission.submission_date.strftime('%b %d, %Y at %I:%M %p') }}</p>
                            <p class="mb-1"><strong>Status:</strong> {{ submission.status }}</p>
                            {% if submission.grade %}
                                <p class="mb-0"><strong>Grade:</strong> {{ submission.grade }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    <div class="mb-3">
                        <label for="content_text" class="form-label"><strong>Type your response here:</strong></label>
                        <textarea class="form-control" id="content_text" name="content_text" rows="8">{{ submission.content_text if submission }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="submitted_file" class="form-label"><strong>Or upload a file:</strong></label>
                        <input class="form-control" type="file" id="submitted_file" name="submitted_file">
                        {% if submission and submission.submitted_file_path %}
                        <div class="form-text">
                            Current file: <a href="{{ url_for('static', filename='uploads/' + submission.submitted_file_path) }}" target="_blank">{{ submission.submitted_file_path|regex_replace('^scan_sub_\\d+_\\d+_\\d+_', '') }}</a>. Uploading a new file will replace this one.
                        </div>
                        {% endif %}
                    </div>
                    <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
                        <a href="{{ url_for('student_dashboard_section', section='assignments') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle-fill me-2"></i>{% if submission %}Resubmit Assignment{% else %}Submit Assignment{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    {% elif form_type == 'profile_edit' %}
        <!-- Student Profile Edit Form -->
        <h2 class="mb-4">Edit My Profile</h2>
        <div class="card shadow-sm">
            <div class="card-header">
                <h5>Personal Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
        { csrf_token() }
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label for="first_name" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="first_name" name="first_name" value="{{ student.first_name }}" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label for="last_name" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="last_name" name="last_name" value="{{ student.last_name }}" required>
                            </div>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" value="{{ student.email }}">
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="{{ student.phone }}">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea class="form-control" id="address" name="address" rows="3">{{ student.address }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="profile_photo" class="form-label">Profile Photo</label>
                        <input type="file" class="form-control" id="profile_photo" name="profile_photo" accept="image/*">
                        {% if student.photo_filename %}
                        <div class="form-text">
                            Current photo: {{ student.photo_filename }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
                        <a href="{{ url_for('student_dashboard_section', section='home') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    {% elif form_type == 'password_change' %}
        <!-- Password Change Form -->
        <h2 class="mb-4">Change Password</h2>
        <div class="card shadow-sm">
            <div class="card-header">
                <h5>Security Settings</h5>
            </div>
            <div class="card-body">
                <form method="POST">
        { csrf_token() }
                    <div class="mb-3">
                        <label for="current_password" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="current_password" name="current_password" autocomplete="current-password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="new_password" name="new_password" autocomplete="new-password" required>
                        <div class="form-text">
                            Password must be at least 8 characters long and contain letters and numbers.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" autocomplete="new-password" required>
                    </div>
                    <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
                        <a href="{{ url_for('student_dashboard_section', section='settings') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    {% elif form_type == 'preferences' %}
        <!-- Student Preferences Form -->
        <h2 class="mb-4">My Preferences</h2>
        <div class="card shadow-sm">
            <div class="card-header">
                <h5>Notification Settings</h5>
            </div>
            <div class="card-body">
                <form method="POST">
        { csrf_token() }
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="email_notifications" name="email_notifications" {% if preferences.email_notifications %}checked{% endif %}>
                            <label class="form-check-label" for="email_notifications">
                                Receive email notifications for new assignments
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="grade_notifications" name="grade_notifications" {% if preferences.grade_notifications %}checked{% endif %}>
                            <label class="form-check-label" for="grade_notifications">
                                Receive notifications when grades are posted
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="reminder_notifications" name="reminder_notifications" {% if preferences.reminder_notifications %}checked{% endif %}>
                            <label class="form-check-label" for="reminder_notifications">
                                Receive reminders for upcoming assignments
                            </label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="reminder_frequency" class="form-label">Reminder Frequency</label>
                        <select class="form-select" id="reminder_frequency" name="reminder_frequency">
                            <option value="daily" {% if preferences.reminder_frequency == 'daily' %}selected{% endif %}>Daily</option>
                            <option value="weekly" {% if preferences.reminder_frequency == 'weekly' %}selected{% endif %}>Weekly</option>
                            <option value="never" {% if preferences.reminder_frequency == 'never' %}selected{% endif %}>Never</option>
                        </select>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
                        <a href="{{ url_for('student_dashboard_section', section='settings') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Save Preferences</button>
                    </div>
                </form>
            </div>
        </div>

    {% else %}
        <!-- Generic form fallback -->
        <div class="alert alert-warning">
            <h5>Form Not Found</h5>
            <p>The requested form type "{{ form_type }}" is not available.</p>
        </div>
    {% endif %}
{% endblock %} 