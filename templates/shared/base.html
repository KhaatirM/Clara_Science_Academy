<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <!-- Content Security Policy is handled by Flask app headers -->
    <title>{% block title %}Clara Science Academy{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Global CSS to hide CSRF tokens -->
    <style>
        /* Hide any visible CSRF tokens */
        input[name="csrf_token"] {
            display: none !important;
            visibility: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Hide any text that looks like a CSRF token */
        body *:not(input):not(script):not(style):not(meta) {
            font-family: inherit;
        }
    </style>
</head>
<!-- ADDED: A block to allow child templates to add attributes to the body tag -->
<body {% block body_attributes %}{% endblock %}>
    <!-- Using a custom class for the green navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-custom-green">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('auth.home') }}">Clara Science Academy</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <span class="navbar-text me-3">
                                Welcome, {{ current_user.username }} ({{ current_user.role }})
                            </span>
                        </li>
                        <li class="nav-item">
                            {% set role_name = current_user.role|lower|replace(' ', '_') %}
                            {% if role_name == 'school_administrator' %}
                                {% set dashboard_url = url_for('management.management_dashboard') %}
                            {% elif role_name == 'director' %}
                                {% set dashboard_url = url_for('management.management_dashboard') %}
                            {% elif role_name == 'teacher' %}
                                {% set dashboard_url = url_for('teacher.teacher_dashboard') %}
                            {% elif role_name == 'student' %}
                                {% set dashboard_url = url_for('student.student_dashboard') %}
                            {% elif role_name == 'tech' %}
                                {% set dashboard_url = url_for('tech.tech_dashboard') %}
                            {% else %}
                                {% set dashboard_url = url_for('auth.dashboard') %}
                            {% endif %}
                            <a class="nav-link" href="{{ dashboard_url }}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.home') }}">Home</a>
                        </li>
                        
                        <!-- About Us Dropdown -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="aboutUsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                About Us
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="aboutUsDropdown">
                                <li><a class="dropdown-item" href="#" data-page="education-plan">Education Plan</a></li>
                                <li><a class="dropdown-item" href="#" data-page="stem-manifesto">STEM Manifesto</a></li>
                                <li><a class="dropdown-item" href="#" data-page="tuition-assistance">Tuition Assistance</a></li>
                                <li><a class="dropdown-item" href="#" data-page="admission-policy">Admission Policy</a></li>
                                <li><a class="dropdown-item" href="#" data-page="locations">Locations</a></li>
                                <li><a class="dropdown-item" href="#" data-page="board-of-directors">Board of Directors</a></li>
                                <li><a class="dropdown-item" href="#" data-page="board-meeting-minutes">Board Meeting Minutes</a></li>
                            </ul>
                        </li>
                        
                        <!-- CSA Info Dropdown -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="csaInfoDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                CSA Info
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="csaInfoDropdown">
                                <li><a class="dropdown-item" href="#" data-page="employment">Employment</a></li>
                                <li><a class="dropdown-item" href="#" data-page="survey">Survey</a></li>
                                <li><a class="dropdown-item" href="#" data-page="academic-calendar">Academic Calendar</a></li>
                                <li><a class="dropdown-item" href="#" data-page="parent-staff-resources">Parent & Staff Resources</a></li>
                                <li><a class="dropdown-item" href="#" data-page="clarabytes">ClaraBytes</a></li>
                            </ul>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="enrollment">Enrollment</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="faq">FAQ</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="contact-us">Contact Us</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.login') }}">Login</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <main class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    
    <!-- Password Change Modal -->
    {% if current_user.is_authenticated and current_user.is_temporary_password %}
        {% include 'shared/password_change_modal.html' %}
    {% endif %}
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Global JavaScript to hide CSRF tokens -->
    <script>
        // Remove any visible CSRF tokens
        function removeVisibleCSRFTokens() {
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                if (node.textContent && node.textContent.trim()) {
                    const text = node.textContent.trim();
                    // Match CSRF token pattern (base64-like with dots)
                    if (text.match(/^[A-Za-z0-9+/=]+\.[A-Za-z0-9+/=]+\.[A-Za-z0-9+/=]+$/) && text.length > 20) {
                        console.log('Removing visible CSRF token:', text);
                        node.remove();
                    }
                }
            }
        }
        
        // Run on page load and after delays
        document.addEventListener('DOMContentLoaded', function() {
            removeVisibleCSRFTokens();
            setTimeout(removeVisibleCSRFTokens, 100);
            setTimeout(removeVisibleCSRFTokens, 500);
        });
        
        // Also run on DOM mutations
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    removeVisibleCSRFTokens();
                }
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        // Navigation dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Use event delegation to handle clicks on dynamically added content
            document.addEventListener('click', function(e) {
                // Check if the clicked element or its parent has data-page attribute
                const target = e.target.closest('[data-page]');
                if (target) {
                    e.preventDefault();
                    const page = target.getAttribute('data-page');
                    showPageModal(page);
                }
            });
        });
        
        function showPageModal(page) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('pageModal');
            if (!modal) {
                modal = createModal();
                document.body.appendChild(modal);
            }
            
            // Show specific content based on page
            if (page === 'faq') {
                showFAQModal(modal);
            } else if (page === 'contact-us') {
                showContactUsModal(modal);
            } else {
                showPlaceholderModal(modal, page);
            }
            
            // Show the modal
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }
        
        function createModal() {
            // Add custom CSS for enhanced modal design
            if (!document.getElementById('modalCustomCSS')) {
                const style = document.createElement('style');
                style.id = 'modalCustomCSS';
                style.textContent = `
                    /* Enhanced Modal Base Styling */
                    .enhanced-modal .modal-dialog {
                        margin: 2rem auto;
                        max-width: 95%;
                        animation: modalSlideIn 0.4s ease-out;
                    }
                    
                    @keyframes modalSlideIn {
                        from {
                            opacity: 0;
                            transform: translateY(-50px) scale(0.9);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }
                    
                    .enhanced-modal .modal-content {
                        border: none;
                        border-radius: 25px;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
                        overflow: hidden;
                        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
                        position: relative;
                    }
                    
                    .enhanced-modal .modal-content::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 4px;
                        background: linear-gradient(90deg, #007bff 0%, #0056b3 50%, #007bff 100%);
                        background-size: 200% 100%;
                        animation: shimmer 3s ease-in-out infinite;
                    }
                    
                    @keyframes shimmer {
                        0%, 100% { background-position: 200% 0; }
                        50% { background-position: -200% 0; }
                    }
                    
                    .enhanced-modal .modal-header {
                        background: linear-gradient(135deg, #007bff 0%, #0056b3 50%, #004085 100%);
                        border: none;
                        padding: 2rem 2rem 1.5rem;
                        color: white;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .enhanced-modal .modal-header::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        left: -50%;
                        width: 200%;
                        height: 200%;
                        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
                        animation: pulse 4s ease-in-out infinite;
                    }
                    
                    @keyframes pulse {
                        0%, 100% { transform: scale(1) rotate(0deg); }
                        50% { transform: scale(1.1) rotate(180deg); }
                    }
                    
                    .enhanced-modal .modal-title {
                        font-size: 1.75rem;
                        font-weight: 700;
                        margin: 0;
                        display: flex;
                        align-items: center;
                        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                        position: relative;
                        z-index: 1;
                    }
                    
                    .enhanced-modal .modal-title i {
                        background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
                    }
                    
                    .enhanced-modal .btn-close {
                        filter: invert(1) drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
                        opacity: 0.9;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        position: relative;
                        z-index: 2;
                    }
                    
                    .enhanced-modal .btn-close:hover {
                        opacity: 1;
                        transform: scale(1.2) rotate(90deg);
                        filter: invert(1) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
                    }
                    
                    .enhanced-modal .modal-body {
                        padding: 2.5rem;
                        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
                        position: relative;
                    }
                    
                    .enhanced-modal .modal-footer {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
                        border: none;
                        padding: 2rem;
                        border-radius: 0 0 25px 25px;
                        position: relative;
                    }
                    
                    .enhanced-modal .modal-footer::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 2rem;
                        right: 2rem;
                        height: 1px;
                        background: linear-gradient(90deg, transparent 0%, #dee2e6 50%, transparent 100%);
                    }
                    
                    .enhanced-modal .btn-secondary {
                        background: linear-gradient(135deg, #6c757d 0%, #495057 50%, #343a40 100%);
                        border: none;
                        border-radius: 12px;
                        padding: 0.875rem 2.5rem;
                        font-weight: 600;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .enhanced-modal .btn-secondary::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                        transition: left 0.5s;
                    }
                    
                    .enhanced-modal .btn-secondary:hover::before {
                        left: 100%;
                    }
                    
                    .enhanced-modal .btn-secondary:hover {
                        transform: translateY(-3px) scale(1.02);
                        box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
                    }
                    
                    /* Enhanced FAQ Styling */
                    .faq-accordion .accordion-item {
                        border: none;
                        margin-bottom: 1.5rem;
                        border-radius: 20px;
                        overflow: hidden;
                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
                        background: white;
                        transition: all 0.3s ease;
                        position: relative;
                    }
                    
                    .faq-accordion .accordion-item:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
                    }
                    
                    .faq-accordion .accordion-item::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 3px;
                        background: linear-gradient(90deg, #007bff 0%, #0056b3 100%);
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .faq-accordion .accordion-item:hover::before {
                        opacity: 1;
                    }
                    
                    .faq-accordion .accordion-header button {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
                        border: none;
                        padding: 1.5rem 2rem;
                        font-weight: 700;
                        color: #495057;
                        border-radius: 20px 20px 0 0;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .faq-accordion .accordion-header button::after {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                        transition: left 0.6s;
                    }
                    
                    .faq-accordion .accordion-header button:hover::after {
                        left: 100%;
                    }
                    
                    .faq-accordion .accordion-header button:not(.collapsed) {
                        background: linear-gradient(135deg, #007bff 0%, #0056b3 50%, #004085 100%);
                        color: white;
                        box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
                        transform: scale(1.02);
                    }
                    
                    .faq-accordion .accordion-body {
                        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
                        padding: 2rem;
                        border-radius: 0 0 20px 20px;
                        color: #495057;
                        line-height: 1.7;
                        position: relative;
                    }
                    
                    .faq-accordion .accordion-body::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 2rem;
                        right: 2rem;
                        height: 1px;
                        background: linear-gradient(90deg, transparent 0%, #e9ecef 50%, transparent 100%);
                    }
                    
                    /* Enhanced Contact Form Styling */
                    .contact-info-section {
                        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 50%, #f1f3f4 100%);
                        border-radius: 20px;
                        padding: 2.5rem;
                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
                        margin-bottom: 2rem;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .contact-info-section::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 4px;
                        background: linear-gradient(90deg, #007bff 0%, #0056b3 100%);
                    }
                    
                    .contact-info h4 {
                        color: #007bff;
                        font-weight: 700;
                        margin-bottom: 1.25rem;
                        display: flex;
                        align-items: center;
                        text-shadow: 0 1px 2px rgba(0, 123, 255, 0.1);
                    }
                    
                    .contact-info h4 i {
                        margin-right: 1rem;
                        font-size: 1.3rem;
                        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .contact-form-section {
                        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
                        border-radius: 20px;
                        padding: 2.5rem;
                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .contact-form-section::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 4px;
                        background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
                    }
                    
                    .contact-form-section h4 {
                        color: #007bff;
                        font-weight: 700;
                        margin-bottom: 2rem;
                        display: flex;
                        align-items: center;
                        text-shadow: 0 1px 2px rgba(0, 123, 255, 0.1);
                    }
                    
                    .contact-form-section h4 i {
                        margin-right: 1rem;
                        font-size: 1.3rem;
                        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .form-control {
                        border-radius: 12px;
                        border: 2px solid #e9ecef;
                        padding: 1rem 1.25rem;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        font-size: 0.95rem;
                        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
                        position: relative;
                    }
                    
                    .form-control:focus {
                        border-color: #007bff;
                        box-shadow: 0 0 0 0.3rem rgba(0, 123, 255, 0.15), 0 4px 15px rgba(0, 123, 255, 0.2);
                        transform: translateY(-2px);
                        background: #ffffff;
                    }
                    
                    .form-control:hover {
                        border-color: #007bff;
                        transform: translateY(-1px);
                        box-shadow: 0 2px 10px rgba(0, 123, 255, 0.1);
                    }
                    
                    .btn-primary {
                        background: linear-gradient(135deg, #007bff 0%, #0056b3 50%, #004085 100%);
                        border: none;
                        border-radius: 12px;
                        padding: 1rem 2.5rem;
                        font-weight: 700;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
                        position: relative;
                        overflow: hidden;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .btn-primary::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                        transition: left 0.5s;
                    }
                    
                    .btn-primary:hover::before {
                        left: 100%;
                    }
                    
                    .btn-primary:hover {
                        transform: translateY(-3px) scale(1.02);
                        box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
                    }
                    
                    .alert-info {
                        border-radius: 20px;
                        border: none;
                        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 50%, #b3e5fc 100%);
                        color: #0c5460;
                        padding: 2rem;
                        box-shadow: 0 4px 15px rgba(13, 202, 240, 0.2);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .alert-info::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 3px;
                        background: linear-gradient(90deg, #17a2b8 0%, #138496 100%);
                    }
                    
                    .text-primary {
                        color: #007bff !important;
                        text-shadow: 0 1px 2px rgba(0, 123, 255, 0.1);
                    }
                    
                    .form-label {
                        font-weight: 700;
                        color: #495057;
                        margin-bottom: 0.75rem;
                        text-transform: uppercase;
                        font-size: 0.85rem;
                        letter-spacing: 0.5px;
                    }
                    
                    .form-text {
                        color: #6c757d;
                        font-size: 0.875rem;
                        font-style: italic;
                    }
                    
                    /* Welcome Section Styling */
                    .welcome-section {
                        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
                        border-radius: 20px;
                        padding: 2rem;
                        margin-bottom: 2rem;
                        text-align: center;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .welcome-section::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        left: -50%;
                        width: 200%;
                        height: 200%;
                        background: radial-gradient(circle, rgba(0,123,255,0.05) 0%, transparent 70%);
                        animation: rotate 20s linear infinite;
                    }
                    
                    @keyframes rotate {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    
                    .welcome-section h4 {
                        position: relative;
                        z-index: 1;
                        background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    /* Mobile Responsiveness */
                    @media (max-width: 768px) {
                        .enhanced-modal .modal-dialog {
                            margin: 1rem;
                            max-width: calc(100% - 2rem);
                        }
                        
                        .enhanced-modal .modal-body {
                            padding: 1.5rem;
                        }
                        
                        .contact-info-section,
                        .contact-form-section {
                            padding: 1.5rem;
                        }
                        
                        .enhanced-modal .modal-title {
                            font-size: 1.5rem;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            const modal = document.createElement('div');
            modal.id = 'pageModal';
            modal.className = 'modal fade enhanced-modal';
            modal.setAttribute('tabindex', '-1');
            modal.setAttribute('aria-labelledby', 'pageModalLabel');
            modal.setAttribute('aria-hidden', 'true');
            modal.innerHTML = `
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="pageModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="modalBody">
                            <!-- Content will be loaded here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return modal;
        }
        
        function showFAQModal(modal) {
            const modalTitle = modal.querySelector('#pageModalLabel');
            const modalBody = modal.querySelector('#modalBody');
            
            modalTitle.innerHTML = '<i class="fas fa-question-circle me-2"></i>Frequently Asked Questions';
            modalBody.innerHTML = `
                <div class="welcome-section">
                    <h4 class="mb-3">
                        <i class="fas fa-info-circle me-2"></i>Get Answers to Common Questions
                    </h4>
                    <p class="text-muted mb-0">Find quick answers to the most frequently asked questions about Clara Science Academy.</p>
                </div>
                <div class="accordion faq-accordion" id="faqAccordion">
                    <!-- FAQ Items will be added here -->
                </div>
                <div class="text-center mt-4">
                    <div class="alert alert-info">
                        <h6 class="alert-heading">
                            <i class="fas fa-lightbulb me-2"></i>Still have questions?
                        </h6>
                        <p class="mb-2">Can't find what you're looking for? We're here to help!</p>
                        <a href="#" data-page="contact-us" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-envelope me-2"></i>Contact Us
                        </a>
                    </div>
                </div>
            `;
            
            // Add FAQ items after the content is loaded
            setTimeout(() => {
                addFAQItems();
            }, 100);
        }
        
        function showContactUsModal(modal) {
            const modalTitle = modal.querySelector('#pageModalLabel');
            const modalBody = modal.querySelector('#modalBody');
            
            modalTitle.innerHTML = '<i class="fas fa-envelope me-2"></i>Contact Us';
            modalBody.innerHTML = `
                <div class="welcome-section">
                    <h4 class="mb-3">
                        <i class="fas fa-handshake me-2"></i>Get in Touch with Us
                    </h4>
                    <p class="text-muted mb-0">We're here to help! Reach out to us through any of the methods below.</p>
                </div>
                
                <div class="row">
                    <!-- Contact Information -->
                    <div class="col-md-6 mb-4">
                        <div class="contact-info-section">
                            <div class="contact-info">
                                <h4 class="text-primary mb-3">
                                    <i class="fas fa-map-marker-alt me-2"></i>Mailing Address
                                </h4>
                                <p class="mb-2">
                                    <strong>Clara Science Academy</strong><br>
                                    2812 East Bessemer Ave.<br>
                                    Greensboro, NC 27405
                                </p>
                                
                                <h4 class="text-primary mb-3 mt-4">
                                    <i class="fas fa-phone me-2"></i>Phone
                                </h4>
                                <p class="mb-2">
                                    <strong>1-800-567-5110</strong>
                                </p>
                                
                                <h4 class="text-primary mb-3 mt-4">
                                    <i class="fas fa-envelope me-2"></i>Email
                                </h4>
                                <p class="mb-2">
                                    <strong>info@clarascienceacademy.com</strong>
                                </p>
                                
                                <div class="mt-4">
                                    <h4 class="text-primary mb-3">
                                        <i class="fas fa-clock me-2"></i>Office Hours
                                    </h4>
                                    <p class="mb-1"><strong>Monday - Friday:</strong> 8:00 AM - 5:00 PM</p>
                                    <p class="mb-0"><strong>Saturday:</strong> 9:00 AM - 1:00 PM</p>
                                    <p class="text-muted small mt-2">Closed on Sundays and major holidays</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Form -->
                    <div class="col-md-6 mb-4">
                        <div class="contact-form-section">
                            <h4 class="text-primary mb-3">
                                <i class="fas fa-paper-plane me-2"></i>Send us a Message
                            </h4>
                            <form id="contactForm">
                                <div class="mb-3">
                                    <label for="contactName" class="form-label">Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="contactName" name="name" required>
                                    <div class="form-text">Please enter your full name</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="contactEmail" class="form-label">Email Address <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="contactEmail" name="email" required>
                                    <div class="form-text">Please enter a valid email address</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="contactPhone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" id="contactPhone" name="phone" required>
                                    <div class="form-text">Please enter your complete phone number</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="contactMessage" class="form-label">Message <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="contactMessage" name="message" rows="5" maxlength="180" required></textarea>
                                    <div class="form-text">
                                        <span id="charCount">0</span> / 180 characters
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="spamCheck" name="spamCheck">
                                        <label class="form-check-label text-muted" for="spamCheck">
                                            Please do not fill in this field.
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-paper-plane me-2"></i>Send Message
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Information -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h5 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>Additional Ways to Connect
                            </h5>
                            <p class="mb-2">You can also contact us through our main website:</p>
                            <p class="mb-0">
                                <a href="https://clarascienceacademy.com/contact-us/" target="_blank" class="btn btn-outline-info">
                                    <i class="fas fa-external-link-alt me-2"></i>Visit Our Main Website
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            // Add contact form functionality after the content is loaded
            setTimeout(() => {
                setupContactForm();
            }, 100);
        }
        
        function showPlaceholderModal(modal, page) {
            const modalTitle = modal.querySelector('#pageModalLabel');
            const modalBody = modal.querySelector('#modalBody');
            
            modalTitle.textContent = getPageTitle(page);
            modalBody.innerHTML = `
                <div class="text-center">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Content for "${getPageTitle(page)}" will be added here.
                    </div>
                    <p class="text-muted">This page is under construction. Please check back later for detailed information.</p>
                </div>
            `;
        }
        
        function getPageTitle(page) {
            const titles = {
                'education-plan': 'Education Plan',
                'stem-manifesto': 'STEM Manifesto',
                'tuition-assistance': 'Tuition Assistance',
                'admission-policy': 'Admission Policy',
                'locations': 'Locations',
                'board-of-directors': 'Board of Directors',
                'board-meeting-minutes': 'Board Meeting Minutes',
                'employment': 'Employment',
                'survey': 'Survey',
                'academic-calendar': 'Academic Calendar',
                'parent-staff-resources': 'Parent & Staff Resources',
                'clarabytes': 'ClaraBytes',
                'enrollment': 'Enrollment',
                'faq': 'FAQ',
                'contact-us': 'Contact Us'
            };
            return titles[page] || page;
        }
        
        
        function addFAQItems() {
            const accordion = document.getElementById('faqAccordion');
            if (!accordion) return;
            
            const faqItems = [
                {
                    id: 1,
                    question: "When will the school be available for opening?",
                    answer: "Clara Science Academy (CSA) will open in Greensboro in the 2024-2025 school year."
                },
                {
                    id: 2,
                    question: "What should we expect the grade levels to be?",
                    answer: "CSA will begin with grades K-6 and a new grade level will be added each year until we reach grades K-8."
                },
                {
                    id: 3,
                    question: "Where is Clara Science Academy located?",
                    answer: "The school will be located in Greensboro, NC (future locations to be announced in Charlotte, NC, Philadelphia, PA, and Newark, NJ)."
                },
                {
                    id: 4,
                    question: "What is special about your curriculum?",
                    answer: `STEM is a curriculum based on the idea of educating students in four specific disciplines — science, technology, engineering and mathematics — in an interdisciplinary and applied approach. Rather than teach the four disciplines as separate and discrete subjects, STEM integrates them into a cohesive learning paradigm based on real-world applications.
                    <br><br>
                    While placing STEM at the center of our curriculum, it is used to provide a fundamental purpose, definition and identity to the school. A STEM curriculum will be used throughout every classroom. This will be evident in daily instructional techniques, such as using music or drawing to represent thinking, and culminating unit tasks where students synthesize and display their final understanding through a STEM-based project.
                    <br><br>
                    <strong>Important Facts about STEM:</strong><br>
                    Though the United States has historically been a leader in these fields, fewer students have been focusing on these topics recently. According to the U.S. Department of Education, only 16 percent of high school students are interested in a STEM career and have proven a proficiency in mathematics. Currently, nearly 28 percent of high school freshmen declare an interest in a STEM-related field, a department website says, but 57 percent of these students will lose interest by the time they graduate from high school.`
                },
                {
                    id: 5,
                    question: "When does school begin and end?",
                    answer: `<strong>Drop off:</strong> 7:45 a.m.<br>
                    <strong>School begins:</strong> 8:00 a.m.<br>
                    <strong>School ends:</strong> 4:00 p.m.`
                },
                {
                    id: 6,
                    question: "Will you have a before and after school program?",
                    answer: "Yes. We will implement these programs as we learn more about the needs of our students and families. (TBA)"
                },
                {
                    id: 7,
                    question: "How do I enroll my child?",
                    answer: `First complete the short application interest form available under the Enrollment menu item.
                    <br><br>
                    Open enrollment will take place between the months of January and February of the school year. Notification of acceptance will be announced in March.
                    <br><br>
                    Those applicants who were not accepted will be placed on a waiting list. Rolling admissions will continue until all seats are filled.`
                },
                {
                    id: 8,
                    question: "Do siblings get enrollment preference?",
                    answer: `Per the statute, sibling preference can be granted "to siblings of currently enrolled students who were admitted into the school in a previous year." A brand new school does not have any currently enrolled students from the previous year, so that preference cannot be granted in the first year of operation. By the second year, one surname for all the siblings applying will be granted admission at the same time.
                    <br><br>
                    The definition of sibling is any of the following who reside in the same household: half siblings, step-siblings, and children residing in a family foster home.`
                },
                {
                    id: 9,
                    question: "Is the school using the lottery process?",
                    answer: "CSA will use the lottery process for enrollment. (TBA)"
                },
                {
                    id: 10,
                    question: "Do you offer resources for students with special needs?",
                    answer: "Yes. The school will employ qualified staff for Exceptional Children and will implement a School Support Team of teachers and EC specialists. (TBA)"
                },
                {
                    id: 11,
                    question: "Is lunch provided?",
                    answer: "Yes. A complete lunch plan will be available to all registered students at the beginning of the school year. (TBA)"
                },
                {
                    id: 12,
                    question: "Is transportation provided?",
                    answer: "Yes. A complete transportation plan will be available at the beginning of the school year. (TBA)"
                }
            ];
            
            faqItems.forEach(item => {
                const accordionItem = document.createElement('div');
                accordionItem.className = 'accordion-item';
                accordionItem.innerHTML = `
                    <h2 class="accordion-header" id="heading${item.id}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${item.id}" aria-expanded="false" aria-controls="collapse${item.id}">
                            ${item.question}
                        </button>
                    </h2>
                    <div id="collapse${item.id}" class="accordion-collapse collapse" aria-labelledby="heading${item.id}" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            ${item.answer}
                        </div>
                    </div>
                `;
                accordion.appendChild(accordionItem);
            });
        }
        
        function setupContactForm() {
            const contactForm = document.getElementById('contactForm');
            const charCount = document.getElementById('charCount');
            const messageTextarea = document.getElementById('contactMessage');
            
            if (!contactForm) return;
            
            // Character counter for message
            if (messageTextarea && charCount) {
                messageTextarea.addEventListener('input', function() {
                    charCount.textContent = this.value.length;
                });
            }
            
            // Form submission
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(this);
                const name = formData.get('name');
                const email = formData.get('email');
                const phone = formData.get('phone');
                const message = formData.get('message');
                
                // Basic validation
                if (!name || !email || !phone || !message) {
                    alert('Please fill in all required fields.');
                    return;
                }
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address.');
                    return;
                }
                
                // Show success message
                alert('Thank you for your message! We will get back to you as soon as possible.\\n\\nFor immediate assistance, please call us at 1-800-567-5110 or email us at info@clarascienceacademy.com');
                
                // Reset form
                this.reset();
                if (charCount) {
                    charCount.textContent = '0';
                }
            });
        }
    </script>
    
    <!-- Password Change Popup Modal -->
    {% if current_user.is_authenticated and current_user.is_temporary_password %}
        {% include 'shared/password_change_popup.html' %}
    {% elif current_user.is_authenticated and current_user.login_count == 1 and not current_user.password_changed_at %}
        {% include 'shared/password_change_popup.html' %}
    {% endif %}
    
    {% block scripts %}{% endblock %}
    
    <!-- Error Capture System -->
    <script src="{{ url_for('static', filename='js/error_capture.js') }}"></script>
</body>
</html>
