{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-3 px-md-4 px-lg-5">
    <!-- Enhanced Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-white p-4">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <div>
                            <h2 class="mb-2 mb-md-0 fw-bold">
                                <i class="bi bi-quiz me-3"></i>Create Group Quiz Assignment
                            </h2>
                            <p class="mb-0 opacity-75">Design engaging collaborative quizzes with multiple question types and smart features</p>
                        </div>
                        <div class="d-flex gap-2 mt-3 mt-md-0">
                            <a href="{{ url_for('teacher.group_assignment_type_selector', class_id=class_obj.id) }}" class="btn btn-light btn-sm">
                                <i class="bi bi-arrow-left me-1"></i>Back to Assignment Types
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 col-lg-8">
            <form method="POST" enctype="multipart/form-data" id="quizForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <!-- Quiz Information -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-info-circle me-2"></i>Quiz Information</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="title" class="form-label fw-semibold">
                                    <i class="bi bi-journal-text me-1 text-primary"></i>Quiz Title
                                </label>
                                <input type="text" class="form-control form-control-lg" id="title" name="title" required 
                                       placeholder="Enter a descriptive title for your quiz">
                                <div class="form-text">Choose a clear, engaging title that describes the quiz content</div>
                            </div>
                            
                            <div class="col-12">
                                <label for="description" class="form-label fw-semibold">
                                    <i class="bi bi-file-text me-1 text-primary"></i>Description & Instructions
                                </label>
                                <textarea class="form-control" id="description" name="description" rows="4" 
                                          placeholder="Provide instructions, learning objectives, and any special notes for the quiz..."></textarea>
                                <div class="form-text">Include clear instructions and any important information for students</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Configuration -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-gear me-2"></i>Quiz Configuration</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="time_limit" class="form-label fw-semibold">
                                    <i class="bi bi-clock me-1 text-success"></i>Time Limit (minutes)
                                </label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="time_limit" name="time_limit" 
                                           min="1" max="300" value="30">
                                    <span class="input-group-text">minutes</span>
                                </div>
                                <div class="form-text">Set a time limit for the quiz (0 = no limit)</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="passing_score" class="form-label fw-semibold">
                                    <i class="bi bi-trophy me-1 text-success"></i>Passing Score
                                </label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="passing_score" name="passing_score" 
                                           min="0" max="100" value="70">
                                    <span class="input-group-text">%</span>
                                </div>
                                <div class="form-text">Minimum score required to pass</div>
                            </div>
                            
                            <div class="col-12">
                                <h6 class="fw-semibold text-muted mb-3">Advanced Options</h6>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="shuffle_questions" name="shuffle_questions">
                                            <label class="form-check-label fw-semibold" for="shuffle_questions">
                                                <i class="bi bi-shuffle me-2 text-success"></i>Shuffle Questions
                                            </label>
                                            <div class="form-text">Randomize question order</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="show_correct_answers" name="show_correct_answers">
                                            <label class="form-check-label fw-semibold" for="show_correct_answers">
                                                <i class="bi bi-eye me-2 text-success"></i>Show Correct Answers
                                            </label>
                                            <div class="form-text">Display correct answers after submission</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="allow_save_and_continue" name="allow_save_and_continue">
                                            <label class="form-check-label fw-semibold" for="allow_save_and_continue">
                                                <i class="bi bi-save me-2 text-success"></i>Save & Continue
                                            </label>
                                            <div class="form-text">Allow saving progress and returning later</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Group Settings -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-people me-2"></i>Group Settings</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="group_size_min" class="form-label fw-semibold">
                                    <i class="bi bi-people me-1 text-warning"></i>Minimum Group Size
                                </label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="group_size_min" name="group_size_min" 
                                           min="1" max="10" value="2">
                                    <span class="input-group-text">students</span>
                                </div>
                                <div class="form-text">Minimum number of students per group</div>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="group_size_max" class="form-label fw-semibold">
                                    <i class="bi bi-people-fill me-1 text-warning"></i>Maximum Group Size
                                </label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="group_size_max" name="group_size_max" 
                                           min="2" max="20" value="4">
                                    <span class="input-group-text">students</span>
                                </div>
                                <div class="form-text">Maximum number of students per group</div>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="collaboration_type" class="form-label fw-semibold">
                                    <i class="bi bi-gear me-1 text-warning"></i>Collaboration Type
                                </label>
                                <select class="form-select" id="collaboration_type" name="collaboration_type">
                                    <option value="group">Group Work Only</option>
                                    <option value="individual">Individual Work Only</option>
                                    <option value="both">Allow Both Group and Individual</option>
                                </select>
                                <div class="form-text">Choose the collaboration approach</div>
                            </div>
                            
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="allow_individual" name="allow_individual">
                                    <label class="form-check-label fw-semibold" for="allow_individual">
                                        <i class="bi bi-person me-2 text-warning"></i>Allow Individual Submissions
                                    </label>
                                    <div class="form-text">Students can submit answers individually even if working in groups</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Questions Section -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-question-circle me-2"></i>Quiz Questions</h5>
                    </div>
                    <div class="card-body p-4">
                        <div id="questionsContainer">
                            <div class="text-center py-4" id="noQuestionsMessage">
                                <i class="bi bi-question-circle text-muted mb-3" style="font-size: 3rem;"></i>
                                <h6 class="text-muted">No questions added yet</h6>
                                <p class="text-muted mb-4">Start building your quiz by adding questions</p>
                                <button type="button" class="btn btn-primary btn-lg" onclick="addQuestion()">
                                    <i class="bi bi-plus-circle me-2"></i>Add Your First Question
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4" id="addQuestionBtn" style="display: none;">
                            <button type="button" class="btn btn-outline-primary" onclick="addQuestion()">
                                <i class="bi bi-plus-circle me-2"></i>Add Another Question
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Due Date & Academic Period -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-calendar me-2"></i>Due Date & Academic Period</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="due_date" class="form-label fw-semibold">
                                    <i class="bi bi-clock me-1 text-secondary"></i>Due Date & Time
                                </label>
                                <input type="datetime-local" class="form-control" id="due_date" name="due_date" required>
                                <div class="form-text">When should this quiz be completed?</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="quarter" class="form-label fw-semibold">
                                    <i class="bi bi-calendar3 me-1 text-secondary"></i>Quarter
                                </label>
                                <select class="form-select" id="quarter" name="quarter" required>
                                    <option value="">Select Quarter</option>
                                    <option value="Q1">Quarter 1</option>
                                    <option value="Q2">Quarter 2</option>
                                    <option value="Q3">Quarter 3</option>
                                    <option value="Q4">Quarter 4</option>
                                </select>
                                <div class="form-text">Which quarter does this quiz belong to?</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="semester" class="form-label fw-semibold">
                                    <i class="bi bi-calendar-range me-1 text-secondary"></i>Semester
                                </label>
                                <select class="form-select" id="semester" name="semester">
                                    <option value="">Select Semester (Optional)</option>
                                    <option value="S1">Semester 1</option>
                                    <option value="S2">Semester 2</option>
                                </select>
                                <div class="form-text">Optional semester classification</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="academic_period_id" class="form-label fw-semibold">
                                    <i class="bi bi-calendar-check me-1 text-secondary"></i>Academic Period
                                </label>
                                <select class="form-select" id="academic_period_id" name="academic_period_id">
                                    <option value="">Select Academic Period (Optional)</option>
                                    {% for period in academic_periods %}
                                        <option value="{{ period.id }}">{{ period.name }} ({{ period.period_type }})</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">Optional specific academic period</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="{{ url_for('teacher.group_assignment_type_selector', class_id=class_obj.id) }}" 
                               class="btn btn-outline-secondary btn-lg">
                                <i class="bi bi-arrow-left me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-success btn-lg fw-bold" id="submitBtn" disabled>
                                <i class="bi bi-check-circle me-2"></i>Create Group Quiz
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <div class="col-12 col-lg-4">
            <!-- Live Preview -->
            <div class="card mb-4 border-0 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0 fw-bold"><i class="bi bi-eye me-2"></i>Quiz Preview</h6>
                </div>
                <div class="card-body">
                    <div id="quizPreview">
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-quiz mb-2" style="font-size: 2rem;"></i>
                            <p class="mb-0">Quiz preview will appear here</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Stats -->
            <div class="card mb-4 border-0 shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0 fw-bold"><i class="bi bi-graph-up me-2"></i>Quiz Stats</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="border-end">
                                <h4 class="mb-1 text-primary" id="questionCount">0</h4>
                                <small class="text-muted">Questions</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <h4 class="mb-1 text-success" id="totalPoints">0</h4>
                            <small class="text-muted">Total Points</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Types Guide -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0 fw-bold"><i class="bi bi-book me-2"></i>Question Types</h6>
                </div>
                <div class="card-body">
                    <div class="question-types">
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-list-ul text-primary me-3"></i>
                            <div>
                                <strong>Multiple Choice</strong>
                                <br><small class="text-muted">Single correct answer from options</small>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-toggle-on text-success me-3"></i>
                            <div>
                                <strong>True/False</strong>
                                <br><small class="text-muted">Simple true or false questions</small>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-pencil text-warning me-3"></i>
                            <div>
                                <strong>Short Answer</strong>
                                <br><small class="text-muted">Brief text responses</small>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-file-text text-info me-3"></i>
                            <div>
                                <strong>Essay</strong>
                                <br><small class="text-muted">Detailed written responses</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let questionCount = 0;

document.addEventListener('DOMContentLoaded', function() {
    // Set default due date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateTimeString = tomorrow.toISOString().slice(0, 16);
    document.getElementById('due_date').value = dateTimeString;
    
    // Set default quarter to current quarter
    const currentQuarter = getCurrentQuarter();
    document.getElementById('quarter').value = currentQuarter;
    
    // Form validation
    const form = document.getElementById('quizForm');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('input', validateForm);
    form.addEventListener('change', validateForm);
    
    function validateForm() {
        const title = document.getElementById('title').value.trim();
        const hasQuestions = questionCount > 0;
        
        if (title && hasQuestions) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('btn-secondary');
            submitBtn.classList.add('btn-success');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.remove('btn-success');
            submitBtn.classList.add('btn-secondary');
        }
    }
});

function addQuestion() {
    questionCount++;
    const container = document.getElementById('questionsContainer');
    const noQuestionsMessage = document.getElementById('noQuestionsMessage');
    const addQuestionBtn = document.getElementById('addQuestionBtn');
    
    // Hide no questions message and show add question button
    noQuestionsMessage.style.display = 'none';
    addQuestionBtn.style.display = 'block';
    
    // Create question HTML
    const questionHTML = `
        <div class="question-item mb-4 p-4 border rounded shadow-sm" data-question-id="${questionCount}">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <h6 class="mb-0 fw-bold">
                    <span class="badge bg-primary me-2 question-number-badge">${questionCount}</span>
                    Question ${questionCount}
                </h6>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-secondary" onclick="moveQuestion(${questionCount}, -1)" title="Move Up">
                        <i class="bi bi-arrow-up"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="moveQuestion(${questionCount}, 1)" title="Move Down">
                        <i class="bi bi-arrow-down"></i>
                    </button>
                    <button type="button" class="btn btn-outline-danger" onclick="removeQuestion(${questionCount})" title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label fw-semibold">Question Text</label>
                    <textarea class="form-control" name="question_text_${questionCount}" rows="3" 
                              placeholder="Enter your question here..." required></textarea>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Question Type</label>
                    <select class="form-select" name="question_type_${questionCount}" onchange="updateQuestionOptions(${questionCount})" required>
                        <option value="">Select Type</option>
                        <option value="multiple_choice">Multiple Choice</option>
                        <option value="true_false">True/False</option>
                        <option value="short_answer">Short Answer</option>
                        <option value="essay">Essay</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Points</label>
                    <input type="number" class="form-control" name="question_points_${questionCount}" 
                           min="0.1" step="0.1" value="1.0" required>
                </div>
            </div>
            
            <div class="question-options mt-3" id="options_${questionCount}" style="display: none;">
                <label class="form-label fw-semibold">Answer Options</label>
                <div class="options-container">
                    <!-- Options will be added dynamically -->
                </div>
                <div class="mt-2">
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addOption(${questionCount})">
                        <i class="bi bi-plus-circle me-1"></i>Add Option
                    </button>
                </div>
            </div>
            
            <div class="correct-answer mt-3" id="correct_${questionCount}" style="display: none;">
                <label class="form-label fw-semibold">Correct Answer</label>
                <select class="form-select" name="correct_answer_${questionCount}">
                    <option value="">Select Correct Answer</option>
                </select>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', questionHTML);
    updateQuizPreview();
    updateQuizStats();
}

function updateQuestionOptions(questionId) {
    const questionType = document.querySelector(`select[name="question_type_${questionId}"]`).value;
    const optionsContainer = document.getElementById(`options_${questionId}`);
    const correctAnswerContainer = document.getElementById(`correct_${questionId}`);
    
    if (questionType === 'multiple_choice') {
        optionsContainer.style.display = 'block';
        correctAnswerContainer.style.display = 'block';
        addInitialOptions(questionId);
    } else if (questionType === 'true_false') {
        optionsContainer.style.display = 'block';
        correctAnswerContainer.style.display = 'block';
        addTrueFalseOptions(questionId);
    } else {
        optionsContainer.style.display = 'none';
        correctAnswerContainer.style.display = 'none';
    }
}

function addInitialOptions(questionId) {
    const optionsContainer = document.querySelector(`#options_${questionId} .options-container`);
    optionsContainer.innerHTML = '';
    
    for (let i = 0; i < 4; i++) {
        addOption(questionId);
    }
}

function addTrueFalseOptions(questionId) {
    const optionsContainer = document.querySelector(`#options_${questionId} .options-container`);
    optionsContainer.innerHTML = '';
    
    // Add True option
    optionsContainer.innerHTML += `
        <div class="option-item mb-2">
            <div class="input-group">
                <span class="input-group-text">A</span>
                <input type="text" class="form-control" name="option_text_${questionId}[]" value="True" readonly>
            </div>
        </div>
    `;
    
    // Add False option
    optionsContainer.innerHTML += `
        <div class="option-item mb-2">
            <div class="input-group">
                <span class="input-group-text">B</span>
                <input type="text" class="form-control" name="option_text_${questionId}[]" value="False" readonly>
            </div>
        </div>
    `;
    
    updateCorrectAnswerOptions(questionId);
}

function addOption(questionId) {
    const optionsContainer = document.querySelector(`#options_${questionId} .options-container`);
    const optionCount = optionsContainer.children.length;
    const optionLetter = String.fromCharCode(65 + optionCount); // A, B, C, D...
    
    const optionHTML = `
        <div class="option-item mb-2">
            <div class="input-group">
                <span class="input-group-text">${optionLetter}</span>
                <input type="text" class="form-control" name="option_text_${questionId}[]" 
                       placeholder="Enter option text" required>
                <button type="button" class="btn btn-outline-danger" onclick="removeOption(this)">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>
    `;
    
    optionsContainer.insertAdjacentHTML('beforeend', optionHTML);
    updateCorrectAnswerOptions(questionId);
}

function removeOption(button) {
    button.closest('.option-item').remove();
    // Update option letters and correct answer options
    const questionId = button.closest('[data-question-id]').dataset.questionId;
    updateOptionLetters(questionId);
    updateCorrectAnswerOptions(questionId);
}

function updateOptionLetters(questionId) {
    const optionsContainer = document.querySelector(`#options_${questionId} .options-container`);
    const options = optionsContainer.querySelectorAll('.option-item');
    
    options.forEach((option, index) => {
        const letter = String.fromCharCode(65 + index);
        option.querySelector('.input-group-text').textContent = letter;
    });
}

function updateCorrectAnswerOptions(questionId) {
    const correctSelect = document.querySelector(`select[name="correct_answer_${questionId}"]`);
    const optionsContainer = document.querySelector(`#options_${questionId} .options-container`);
    const options = optionsContainer.querySelectorAll('.option-item');
    
    correctSelect.innerHTML = '<option value="">Select Correct Answer</option>';
    
    options.forEach((option, index) => {
        const optionText = option.querySelector('input').value || `Option ${String.fromCharCode(65 + index)}`;
        correctSelect.innerHTML += `<option value="${index}">${optionText}</option>`;
    });
}

function removeQuestion(questionId) {
    document.querySelector(`[data-question-id="${questionId}"]`).remove();
    questionCount--;
    updateQuestionNumbers();
    updateQuizPreview();
    updateQuizStats();
    
    // Show no questions message if no questions left
    if (questionCount === 0) {
        document.getElementById('noQuestionsMessage').style.display = 'block';
        document.getElementById('addQuestionBtn').style.display = 'none';
    }
}

function moveQuestion(questionId, direction) {
    const questionElement = document.querySelector(`[data-question-id="${questionId}"]`);
    const questions = Array.from(document.querySelectorAll('.question-item'));
    const currentIndex = questions.indexOf(questionElement);
    const newIndex = currentIndex + direction;
    
    if (newIndex >= 0 && newIndex < questions.length) {
        if (direction > 0) {
            questionElement.parentNode.insertBefore(questionElement, questions[newIndex].nextSibling);
        } else {
            questionElement.parentNode.insertBefore(questionElement, questions[newIndex]);
        }
        updateQuestionNumbers();
    }
}

function updateQuestionNumbers() {
    const questions = document.querySelectorAll('.question-item');
    questions.forEach((question, index) => {
        const questionNumber = index + 1;
        question.querySelector('.question-number-badge').textContent = questionNumber;
        question.querySelector('h6').innerHTML = `
            <span class="badge bg-primary me-2 question-number-badge">${questionNumber}</span>
            Question ${questionNumber}
        `;
    });
}

function updateQuizPreview() {
    const title = document.getElementById('title').value;
    const description = document.getElementById('description').value;
    const timeLimit = document.getElementById('time_limit').value;
    const passingScore = document.getElementById('passing_score').value;
    
    let previewHTML = '<div class="quiz-preview">';
    
    if (title) {
        previewHTML += `<h6 class="fw-bold text-primary mb-2">${title}</h6>`;
    }
    
    if (description) {
        previewHTML += `<p class="text-muted small mb-2">${description.substring(0, 100)}${description.length > 100 ? '...' : ''}</p>`;
    }
    
    if (timeLimit) {
        previewHTML += `<small class="text-info"><i class="bi bi-clock me-1"></i>Time Limit: ${timeLimit} minutes</small><br>`;
    }
    
    if (passingScore) {
        previewHTML += `<small class="text-success"><i class="bi bi-trophy me-1"></i>Passing Score: ${passingScore}%</small><br>`;
    }
    
    if (questionCount > 0) {
        previewHTML += `<small class="text-secondary"><i class="bi bi-question-circle me-1"></i>${questionCount} question${questionCount !== 1 ? 's' : ''}</small>`;
    }
    
    previewHTML += '</div>';
    
    document.getElementById('quizPreview').innerHTML = previewHTML;
}

function updateQuizStats(questionCount = null, totalPoints = null) {
    if (questionCount === null) {
        questionCount = document.querySelectorAll('.question-item').length;
    }
    
    if (totalPoints === null) {
        totalPoints = 0;
        document.querySelectorAll('input[name^="question_points_"]').forEach(input => {
            totalPoints += parseFloat(input.value) || 0;
        });
    }
    
    document.getElementById('questionCount').textContent = questionCount;
    document.getElementById('totalPoints').textContent = totalPoints.toFixed(1);
}

function getCurrentQuarter() {
    const now = new Date();
    const month = now.getMonth() + 1; // 0-indexed
    if (month >= 1 && month <= 3) return 'Q1';
    if (month >= 4 && month <= 6) return 'Q2';
    if (month >= 7 && month <= 9) return 'Q3';
    return 'Q4';
}

// Add event listeners for dynamic updates
document.addEventListener('input', function(e) {
    if (e.target.name && e.target.name.startsWith('question_points_')) {
        updateQuizStats();
    }
});
</script>

<style>
.question-item {
    transition: all 0.3s ease;
    border-left: 4px solid #007bff !important;
}

.question-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
}

.option-item {
    transition: all 0.2s ease;
}

.option-item:hover {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
}

.quiz-preview {
    border-left: 3px solid #17a2b8;
    padding-left: 1rem;
}

.btn-success {
    background: linear-gradient(135deg, #28a745, #20c997);
    border: none;
    transition: all 0.3s ease;
}

.btn-success:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.3);
}

.btn-success:disabled {
    background: #6c757d;
    transform: none;
    box-shadow: none;
}
</style>
{% endblock %}
