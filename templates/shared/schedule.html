{% extends "shared/dashboard_layout.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/students_role_student_dashboard.css') }}">
{% endblock %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
    <!-- Schedule Header - same idea for teachers and students -->
    <div class="student-schedule-header mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
                <h2 class="student-schedule-title mb-1">
                    <i class="bi bi-calendar-week-fill me-2"></i>
                    {% if schedule_role == 'teacher' %}My Weekly Schedule{% else %}My Schedule{% endif %}
                </h2>
                <p class="student-schedule-subtitle mb-0">
                    <i class="bi bi-clock me-2"></i>
                    {% if schedule_role == 'teacher' %}
                    Your class times — set in Classes → Edit class → Schedule.
                    {% else %}
                    Your class times — set by your school in the class schedule.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    {% if weekly_schedule %}
    <div class="schedule-container">
        <div class="row g-3">
            {% for day_num in range(7) %}
            {% set day_data = weekly_schedule[day_num] %}
            <div class="col-12 col-md-6 col-lg-4">
                <div class="schedule-day-card {% if day_num == today_weekday %}today{% endif %}">
                    <div class="schedule-day-header">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar3 me-2"></i>{{ day_data.day_name }}
                            {% if day_num == today_weekday %}
                            <span class="badge bg-primary ms-2">Today</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="schedule-day-body">
                        {% if day_data.schedules %}
                            {% for schedule_item in day_data.schedules %}
                            <div class="schedule-item">
                                <div class="schedule-item-header">
                                    <h6 class="mb-1">
                                        <i class="bi bi-book-fill me-2"></i>{{ schedule_item.class.name }}
                                    </h6>
                                    <span class="badge bg-info">{{ schedule_item.class.subject or 'General' }}</span>
                                </div>
                                <div class="schedule-item-details">
                                    <div class="schedule-detail">
                                        <i class="bi bi-clock me-2"></i>
                                        <span>{{ schedule_item.time_str }}</span>
                                    </div>
                                    <div class="schedule-detail">
                                        <i class="bi bi-geo-alt me-2"></i>
                                        <span>Room: {{ schedule_item.room }}</span>
                                    </div>
                                    {% if schedule_role == 'teacher' %}
                                    <div class="schedule-detail">
                                        <i class="bi bi-people-fill me-2"></i>
                                        <span>{{ schedule_item.student_count }} student{{ 's' if schedule_item.student_count != 1 else '' }}</span>
                                    </div>
                                    <div class="schedule-detail mt-2">
                                        <a href="{{ url_for('teacher.dashboard.view_class', class_id=schedule_item.class.id) }}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye me-1"></i>View Class
                                        </a>
                                    </div>
                                    {% else %}
                                    <div class="schedule-detail">
                                        <i class="bi bi-person-fill me-2"></i>
                                        <span>Teacher: {{ schedule_item.teacher_name or 'TBD' }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="schedule-empty">
                                <i class="bi bi-calendar-x me-2"></i>No classes scheduled
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <h5><i class="bi bi-info-circle me-2"></i>No Schedule Available</h5>
        <p>
            {% if schedule_role == 'teacher' %}
            You don't have any scheduled classes yet. Ask an administrator to set your class schedule in Classes → Edit class → Schedule.
            {% else %}
            No class times are set for your classes yet. Your school will set the schedule in the class settings.
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}
