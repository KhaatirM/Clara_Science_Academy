{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
        <h3 class="mb-2 mb-md-0">
            <i class="bi bi-calendar-check me-2"></i>School Day Attendance
        </h3>
        <div class="d-flex gap-2">
            <a href="{{ url_for('management.attendance') }}" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left me-1"></i>Back to Attendance Hub
            </a>
        </div>
    </div>

    <!-- Date Selection -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-calendar me-2"></i>Select Date</h6>
        </div>
        <div class="card-body">
            <form method="GET" class="row g-3">
                <div class="col-12 col-sm-6 col-md-4">
                    <label for="date" class="form-label">Attendance Date</label>
                    <input type="date" class="form-control" id="date" name="date" 
                           value="{{ selected_date_str }}" required>
                </div>
                <div class="col-12 col-sm-6 col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i>Load Date
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Attendance Statistics -->
    <div class="row g-2 g-md-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card text-center bg-success text-white h-100" style="border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div class="card-body p-3 p-md-4">
                    <h4 class="mb-1 mb-md-2" style="font-size: 1.75rem; font-weight: 700;">{{ attendance_stats.present }}</h4>
                    <small style="font-size: 0.85rem; font-weight: 500;">Present</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center bg-danger text-white h-100" style="border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div class="card-body p-3 p-md-4">
                    <h4 class="mb-1 mb-md-2" style="font-size: 1.75rem; font-weight: 700;">{{ attendance_stats.absent }}</h4>
                    <small style="font-size: 0.85rem; font-weight: 500;">Absent</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center bg-warning text-dark h-100" style="border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div class="card-body p-3 p-md-4">
                    <h4 class="mb-1 mb-md-2" style="font-size: 1.75rem; font-weight: 700;">{{ attendance_stats.late }}</h4>
                    <small style="font-size: 0.85rem; font-weight: 500;">Late</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center bg-info text-white h-100" style="border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div class="card-body p-3 p-md-4">
                    <h4 class="mb-1 mb-md-2" style="font-size: 1.75rem; font-weight: 700;">{{ attendance_stats.excused }}</h4>
                    <small style="font-size: 0.85rem; font-weight: 500;">Excused</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Form -->
    <div class="card">
        <div class="card-header bg-light">
            <h6 class="mb-0">
                <i class="bi bi-people me-2"></i>
                Student Attendance for {{ selected_date.strftime('%B %d, %Y') }}
            </h6>
        </div>
        <div class="card-body">
            <form method="POST" id="attendanceForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="attendance_date" value="{{ selected_date_str }}">
                
                <!-- Desktop Table View -->
                <div class="table-responsive d-none d-md-block">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 30%;">Student Name</th>
                                <th style="width: 15%;">Grade</th>
                                <th style="width: 15%;">Student ID</th>
                                <th style="width: 20%;">Status</th>
                                <th style="width: 20%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td>
                                    <strong>{{ student.first_name }} {{ student.last_name }}</strong>
                                </td>
                                <td>{{ student.grade_level }}</td>
                                <td>{{ student.student_id }}</td>
                                <td>
                                    {% set existing_record = existing_records.get(student.id) %}
                                    <div class="btn-group status-btn-group" role="group">
                                        <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                               id="present_{{ student.id }}" value="Present" 
                                               {% if existing_record and existing_record.status == 'Present' %}checked{% endif %}
                                               onchange="updateRowColor(this)">
                                        <label class="btn btn-status-present" for="present_{{ student.id }}">
                                            <i class="bi bi-check-circle-fill me-1"></i>Present
                                        </label>
                                        
                                        <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                               id="absent_{{ student.id }}" value="Absent" 
                                               {% if existing_record and existing_record.status == 'Absent' %}checked{% endif %}
                                               onchange="updateRowColor(this)">
                                        <label class="btn btn-status-absent" for="absent_{{ student.id }}">
                                            <i class="bi bi-x-circle-fill me-1"></i>Absent
                                        </label>
                                        
                                        <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                               id="late_{{ student.id }}" value="Late" 
                                               {% if existing_record and existing_record.status == 'Late' %}checked{% endif %}
                                               onchange="updateRowColor(this)">
                                        <label class="btn btn-status-late" for="late_{{ student.id }}">
                                            <i class="bi bi-clock-fill me-1"></i>Late
                                        </label>
                                        
                                        <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                               id="excused_{{ student.id }}" value="Excused Absence" 
                                               {% if existing_record and existing_record.status == 'Excused Absence' %}checked{% endif %}
                                               onchange="updateRowColor(this)">
                                        <label class="btn btn-status-excused" for="excused_{{ student.id }}">
                                            <i class="bi bi-info-circle-fill me-1"></i>Excused
                                        </label>
                                    </div>
                                </td>
                                <td>
                                    <input type="text" name="notes_{{ student.id }}" 
                                           class="form-control form-control-sm" 
                                           placeholder="Optional notes"
                                           value="{% if existing_record %}{{ existing_record.notes or '' }}{% endif %}">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Card View -->
                <div class="d-md-none">
                    {% for student in students %}
                    {% set existing_record = existing_records.get(student.id) %}
                    <div class="card mb-3 mobile-student-card" id="mobile-card-{{ student.id }}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="card-title mb-1" style="font-weight: 600;">
                                        {{ student.first_name }} {{ student.last_name }}
                                    </h6>
                                    <div class="d-flex gap-3 text-muted small">
                                        <span><i class="bi bi-mortarboard me-1"></i>Grade {{ student.grade_level }}</span>
                                        <span><i class="bi bi-person-badge me-1"></i>ID: {{ student.student_id }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Buttons - Mobile Optimized -->
                            <div class="mb-3">
                                <label class="form-label small fw-bold mb-2">Attendance Status</label>
                                <div class="status-btn-group-mobile d-grid gap-2">
                                    <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                           id="mobile_present_{{ student.id }}" value="Present" 
                                           {% if existing_record and existing_record.status == 'Present' %}checked{% endif %}
                                           onchange="updateRowColor(this)">
                                    <label class="btn btn-status-present-mobile" for="mobile_present_{{ student.id }}">
                                        <i class="bi bi-check-circle-fill me-2"></i>Present
                                    </label>
                                    
                                    <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                           id="mobile_absent_{{ student.id }}" value="Absent" 
                                           {% if existing_record and existing_record.status == 'Absent' %}checked{% endif %}
                                           onchange="updateRowColor(this)">
                                    <label class="btn btn-status-absent-mobile" for="mobile_absent_{{ student.id }}">
                                        <i class="bi bi-x-circle-fill me-2"></i>Absent
                                    </label>
                                    
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                                   id="mobile_late_{{ student.id }}" value="Late" 
                                                   {% if existing_record and existing_record.status == 'Late' %}checked{% endif %}
                                                   onchange="updateRowColor(this)">
                                            <label class="btn btn-status-late-mobile w-100" for="mobile_late_{{ student.id }}">
                                                <i class="bi bi-clock-fill me-2"></i>Late
                                            </label>
                                        </div>
                                        <div class="col-6">
                                            <input type="radio" class="btn-check status-radio" name="status_{{ student.id }}" 
                                                   id="mobile_excused_{{ student.id }}" value="Excused Absence" 
                                                   {% if existing_record and existing_record.status == 'Excused Absence' %}checked{% endif %}
                                                   onchange="updateRowColor(this)">
                                            <label class="btn btn-status-excused-mobile w-100" for="mobile_excused_{{ student.id }}">
                                                <i class="bi bi-info-circle-fill me-2"></i>Excused
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notes Field -->
                            <div>
                                <label for="mobile_notes_{{ student.id }}" class="form-label small fw-bold">Notes</label>
                                <input type="text" name="notes_{{ student.id }}" 
                                       id="mobile_notes_{{ student.id }}"
                                       class="form-control" 
                                       placeholder="Optional notes"
                                       value="{% if existing_record %}{{ existing_record.notes or '' }}{% endif %}">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Enhanced Status Action Buttons -->
                <div class="mt-4 mb-3">
                    <div class="d-flex flex-column flex-md-row flex-wrap gap-3 align-items-start align-items-md-center" 
                         style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <div class="flex-grow-1 w-100 w-md-auto">
                            <h6 class="mb-1 mb-md-0 text-dark" style="font-weight: 600;">
                                <i class="bi bi-lightning-charge-fill me-2" style="color: #dc3545;"></i>Quick Actions
                            </h6>
                            <small class="text-muted d-block d-md-inline">Apply status to all students at once</small>
                        </div>
                        <div class="d-grid d-md-flex flex-wrap gap-2 w-100 w-md-auto" style="grid-template-columns: repeat(2, 1fr);">
                            <button type="button" class="btn btn-status-action btn-all-present" onclick="markAllPresent()" 
                                    style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: 2px solid #28a745; color: white; font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3); transition: all 0.3s ease; min-height: 48px;">
                                <i class="bi bi-check-circle-fill me-2"></i><span class="d-none d-sm-inline">All </span>Present
                            </button>
                            <button type="button" class="btn btn-status-action btn-all-absent" onclick="markAllAbsent()"
                                    style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border: 2px solid #dc3545; color: white; font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3); transition: all 0.3s ease; min-height: 48px;">
                                <i class="bi bi-x-circle-fill me-2"></i><span class="d-none d-sm-inline">All </span>Absent
                            </button>
                            <button type="button" class="btn btn-status-action btn-all-late" onclick="markAllLate()"
                                    style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border: 2px solid #ffc107; color: white; font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3); transition: all 0.3s ease; min-height: 48px;">
                                <i class="bi bi-clock-fill me-2"></i><span class="d-none d-sm-inline">All </span>Late
                            </button>
                            <button type="button" class="btn btn-status-action btn-clear-all" onclick="clearAllStatus()"
                                    style="background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); border: 2px solid #6c757d; color: white; font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3); transition: all 0.3s ease; min-height: 48px;">
                                <i class="bi bi-arrow-counterclockwise me-2"></i>Clear All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Save Button -->
                <div class="mt-3 d-flex justify-content-center justify-content-md-end">
                    <button type="submit" class="btn w-100 w-md-auto" 
                            style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); border: none; color: white; font-weight: 600; padding: 0.875rem 2rem; border-radius: 0.75rem; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4); transition: all 0.3s ease; font-size: 1.1rem; min-height: 50px;">
                        <i class="bi bi-check-circle-fill me-2"></i>Save Attendance
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Enhanced Status Radio Buttons */
.status-btn-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
}

/* Mobile Card Layout */
.mobile-student-card {
    border-left: 4px solid #dee2e6;
    transition: all 0.3s ease;
}

.mobile-student-card.status-present {
    border-left-color: #28a745;
    background-color: #f8fff9;
}

.mobile-student-card.status-absent {
    border-left-color: #dc3545;
    background-color: #fff8f8;
}

.mobile-student-card.status-late {
    border-left-color: #ffc107;
    background-color: #fffef8;
}

.mobile-student-card.status-excused {
    border-left-color: #17a2b8;
    background-color: #f8fcff;
}

/* Mobile Status Buttons - Larger Touch Targets */
.status-btn-group-mobile {
    display: flex;
    flex-direction: column;
}

.btn-status-present-mobile,
.btn-status-absent-mobile,
.btn-status-late-mobile,
.btn-status-excused-mobile {
    border: 2px solid;
    font-weight: 600;
    font-size: 1rem;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    min-height: 48px; /* Minimum touch target size */
}

/* Mobile Present Button */
.btn-status-present-mobile {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border-color: #28a745;
    color: #155724;
}

.btn-check:checked + .btn-status-present-mobile,
.btn-status-present-mobile:hover {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border-color: #28a745;
    color: white;
    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
}

/* Mobile Absent Button */
.btn-status-absent-mobile {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    border-color: #dc3545;
    color: #721c24;
}

.btn-check:checked + .btn-status-absent-mobile,
.btn-status-absent-mobile:hover {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    border-color: #dc3545;
    color: white;
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
}

/* Mobile Late Button */
.btn-status-late-mobile {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-color: #ffc107;
    color: #856404;
}

.btn-check:checked + .btn-status-late-mobile,
.btn-status-late-mobile:hover {
    background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    border-color: #ffc107;
    color: white;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
}

/* Mobile Excused Button */
.btn-status-excused-mobile {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    border-color: #17a2b8;
    color: #0c5460;
}

.btn-check:checked + .btn-status-excused-mobile,
.btn-status-excused-mobile:hover {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    border-color: #17a2b8;
    color: white;
    box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
}

.btn-status-present,
.btn-status-absent,
.btn-status-late,
.btn-status-excused {
    border: 2px solid;
    font-weight: 600;
    font-size: 0.85rem;
    padding: 0.4rem 0.75rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Present Button - Green */
.btn-status-present {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border-color: #28a745;
    color: #155724;
}

.btn-check:checked + .btn-status-present,
.btn-status-present:hover {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border-color: #28a745;
    color: white;
    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
    transform: translateY(-1px);
}

/* Absent Button - Red */
.btn-status-absent {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    border-color: #dc3545;
    color: #721c24;
}

.btn-check:checked + .btn-status-absent,
.btn-status-absent:hover {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    border-color: #dc3545;
    color: white;
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
    transform: translateY(-1px);
}

/* Late Button - Yellow */
.btn-status-late {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-color: #ffc107;
    color: #856404;
}

.btn-check:checked + .btn-status-late,
.btn-status-late:hover {
    background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    border-color: #ffc107;
    color: white;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
    transform: translateY(-1px);
}

/* Excused Button - Blue */
.btn-status-excused {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    border-color: #17a2b8;
    color: #0c5460;
}

.btn-check:checked + .btn-status-excused,
.btn-status-excused:hover {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    border-color: #17a2b8;
    color: white;
    box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
    transform: translateY(-1px);
}

/* Enhanced Button Hover Effects */
.btn-status-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2) !important;
}

.btn-all-present:hover {
    background: linear-gradient(135deg, #20c997 0%, #28a745 100%) !important;
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4) !important;
}

.btn-all-absent:hover {
    background: linear-gradient(135deg, #c82333 0%, #dc3545 100%) !important;
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4) !important;
}

.btn-all-late:hover {
    background: linear-gradient(135deg, #ff9800 0%, #ffc107 100%) !important;
    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4) !important;
}

.btn-clear-all:hover {
    background: linear-gradient(135deg, #5a6268 0%, #6c757d 100%) !important;
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4) !important;
}

.btn-status-action:active {
    transform: translateY(0);
}

/* Save Button Hover */
button[type="submit"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5) !important;
}

button[type="submit"]:active {
    transform: translateY(0);
}

/* Mobile Responsive Improvements */
@media (max-width: 767.98px) {
    .container-fluid {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .mobile-student-card .card-body {
        padding: 1rem;
    }
    
    /* Ensure touch targets are large enough */
    .btn-status-present-mobile,
    .btn-status-absent-mobile,
    .btn-status-late-mobile,
    .btn-status-excused-mobile {
        min-height: 52px;
        font-size: 1.05rem;
    }
    
    /* Better spacing for mobile */
    .status-btn-group-mobile {
        gap: 0.5rem;
    }
    
    /* Full width buttons on very small screens */
    @media (max-width: 375px) {
        .btn-status-action {
            width: 100%;
        }
    }
}
</style>

<script>
function updateRowColor(element) {
    let status = element.value;
    
    // Update desktop table row
    const row = element.closest('tr');
    if (row) {
        row.classList.remove('table-success', 'table-danger', 'table-warning', 'table-info');
        if (status === 'Present') {
            row.classList.add('table-success');
        } else if (status === 'Absent') {
            row.classList.add('table-danger');
        } else if (status === 'Late') {
            row.classList.add('table-warning');
        } else if (status === 'Excused Absence') {
            row.classList.add('table-info');
        }
    }
    
    // Update mobile card
    updateMobileCardColor(element);
}

function updateMobileCardColor(element) {
    const status = element.value;
    const studentId = element.name.split('_')[1];
    const card = document.getElementById('mobile-card-' + studentId);
    
    if (card) {
        card.classList.remove('status-present', 'status-absent', 'status-late', 'status-excused');
        if (status === 'Present') {
            card.classList.add('status-present');
        } else if (status === 'Absent') {
            card.classList.add('status-absent');
        } else if (status === 'Late') {
            card.classList.add('status-late');
        } else if (status === 'Excused Absence') {
            card.classList.add('status-excused');
        }
    }
}

function markAllPresent() {
    const statusRadios = document.querySelectorAll('input[name^="status_"][value="Present"]');
    statusRadios.forEach(radio => {
        radio.checked = true;
        updateRowColor(radio);
    });
}

function markAllAbsent() {
    const statusRadios = document.querySelectorAll('input[name^="status_"][value="Absent"]');
    statusRadios.forEach(radio => {
        radio.checked = true;
        updateRowColor(radio);
    });
}

function markAllLate() {
    const statusRadios = document.querySelectorAll('input[name^="status_"][value="Late"]');
    statusRadios.forEach(radio => {
        radio.checked = true;
        updateRowColor(radio);
    });
}

function clearAllStatus() {
    const statusRadios = document.querySelectorAll('input[name^="status_"].status-radio');
    statusRadios.forEach(radio => {
        radio.checked = false;
        const row = radio.closest('tr');
        row.classList.remove('table-success', 'table-danger', 'table-warning', 'table-info');
    });
}

// Initialize row colors on page load
document.addEventListener('DOMContentLoaded', function() {
    const statusRadios = document.querySelectorAll('input[name^="status_"].status-radio:checked');
    statusRadios.forEach(radio => {
        updateRowColor(radio);
    });
    
    // Sync mobile and desktop radio buttons
    document.querySelectorAll('input[name^="status_"].status-radio').forEach(radio => {
        radio.addEventListener('change', function() {
            // Sync all radio buttons with the same name
            const name = this.name;
            const value = this.value;
            document.querySelectorAll(`input[name="${name}"].status-radio`).forEach(r => {
                if (r.value === value) {
                    r.checked = true;
                } else if (r !== this) {
                    r.checked = false;
                }
            });
        });
    });
});

// Form submission with confirmation
document.getElementById('attendanceForm').addEventListener('submit', function(e) {
    const selectedCount = document.querySelectorAll('input[name^="status_"].status-radio:checked').length;
    const totalCount = document.querySelectorAll('input[name^="status_"].status-radio').length / 4; // Divide by 4 since each student has 4 radio buttons
    
    if (selectedCount === 0) {
        e.preventDefault();
        alert('Please select attendance status for at least one student.');
        return;
    }
    
    if (selectedCount < totalCount) {
        if (!confirm(`You have only selected attendance for ${selectedCount} out of ${totalCount} students. Do you want to continue?`)) {
            e.preventDefault();
            return;
        }
    }
});
</script>

{% endblock %}
