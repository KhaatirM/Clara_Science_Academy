{% extends "shared/dashboard_layout.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/shared_take_attendance.css') }}">
{% endblock %}

{% block title %}
    Take Attendance - {{ class_item.name }}
{% endblock %}

{% block dashboard_content %}
    <!-- Success notification (shown after save) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if category == 'success' %}
                    <div class="alert alert-success alert-dismissible fade show mb-3" role="alert" id="saveSuccessAlert">
                        <i class="bi bi-check-circle-fill me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
<div class="container-fluid px-2 px-md-4 py-4">
    <!-- Header Section -->
    <div class="attendance-header mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
                <h2 class="attendance-title mb-1">
                    <i class="bi bi-clipboard-check-fill me-2"></i>{{ class_item.name }}
                </h2>
                <p class="attendance-subtitle mb-0">
                    <span class="badge bg-primary me-2">{{ class_item.subject }}</span>
                    <span class="text-muted">{{ students|length }} Students Enrolled</span>
                </p>
            </div>
            {% if current_user.role in ['Director', 'School Administrator'] %}
                <a href="{{ url_for('management.unified_attendance') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Back to Attendance
                </a>
            {% else %}
                <a href="{{ url_for('teacher.dashboard.my_classes') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Back to My Classes
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Date Selector & Stats Row -->
    <div class="row g-4 mb-4">
        <!-- Date Selector Card -->
        <div class="col-12 col-lg-4">
            <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
                    <h6 class="card-subtitle mb-3 text-muted">
                        <i class="bi bi-calendar-date me-2"></i>Select Date
                    </h6>
                    <form method="GET" action="{% if current_user.role in ['Director', 'School Administrator'] %}{{ url_for('management.take_class_attendance', class_id=class_item.id) }}{% else %}{{ url_for('teacher.attendance.take_attendance', class_id=class_item.id) }}{% endif %}">
                        <div class="input-group">
                            <input type="date" class="form-control" id="date" name="date" value="{{ attendance_date_str }}" required>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-search me-1"></i>Load
                            </button>
                        </div>
                        <div class="mt-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setToday()">
                                <i class="bi bi-calendar-day me-1"></i>Today
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setYesterday()">
                                <i class="bi bi-calendar-minus me-1"></i>Yesterday
                            </button>
                        </div>
                        <div class="mt-3">
                            <a href="{{ url_for('teacher.attendance.view_attendance_records', class_id=class_item.id) }}" class="btn btn-sm btn-outline-info w-100">
                                <i class="bi bi-clock-history me-1"></i>View Attendance Records
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Live Statistics Cards -->
        <div class="col-12 col-lg-8">
            <div class="row g-3">
                <div class="col-6 col-sm-3">
                    <div class="stat-card stat-card-present">
                        <div class="stat-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="presentCount">{{ attendance_stats.present }}</div>
                            <div class="stat-label">Present</div>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-sm-3">
                    <div class="stat-card stat-card-late">
                        <div class="stat-icon">
                            <i class="bi bi-clock-fill"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="lateCount">{{ attendance_stats.late }}</div>
                            <div class="stat-label">Late</div>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-sm-3">
                    <div class="stat-card stat-card-absent">
                        <div class="stat-icon">
                            <i class="bi bi-x-circle-fill"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="absentCount">{{ attendance_stats.absent }}</div>
                            <div class="stat-label">Absent</div>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-sm-3">
                    <div class="stat-card stat-card-rate">
                        <div class="stat-icon">
                            <i class="bi bi-graph-up-arrow"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="attendanceRate">{{ attendance_stats.present_percentage }}%</div>
                            <div class="stat-label">Rate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Form -->
    <form method="POST" action="{% if current_user.role in ['Director', 'School Administrator'] %}{{ url_for('management.take_class_attendance', class_id=class_item.id) }}{% else %}{{ url_for('teacher.attendance.take_attendance', class_id=class_item.id) }}{% endif %}" id="attendanceForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="date" value="{{ attendance_date_str }}">
                
        <!-- Quick Actions & Bulk Upload Bar -->
        <div class="row g-3 mb-4">
            <!-- Quick Actions Card -->
            <div class="col-12 col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="mb-2">
                            <i class="bi bi-lightning-charge me-2 text-warning"></i>Quick Actions
                        </h6>
                        <small class="text-muted d-block mb-3">Mark all students at once</small>
                        <div class="btn-group w-100" role="group">
                            <button type="button" class="btn btn-outline-success" onclick="markAll('present')">
                                <i class="bi bi-check-all me-1"></i>All Present
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="markAll('absent')">
                                <i class="bi bi-x-lg me-1"></i>All Absent
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="clearAll()">
                                <i class="bi bi-arrow-counterclockwise me-1"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bulk CSV Upload Card -->
            <div class="col-12 col-md-6">
                <div class="card border-0 shadow-sm h-100 bulk-upload-highlight">
                    <div class="card-body">
                        <h6 class="mb-2">
                            <i class="bi bi-cloud-upload me-2 text-primary"></i>Bulk CSV Upload
                        </h6>
                        <small class="text-muted d-block mb-3">Upload historical attendance records</small>
                        <div class="d-flex gap-2 flex-wrap">
                            <a href="{{ url_for('teacher.attendance.download_attendance_template', class_id=class_item.id) }}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-download me-1"></i>Download Template
                            </a>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#bulkUploadModal">
                                <i class="bi bi-upload me-1"></i>Upload CSV
                            </button>
                        </div>
                    </div>
                </div>
            </div>
                </div>

        <!-- Student Attendance Cards -->
        <div class="row g-3 mb-4">
                            {% for student in students %}
                                {% set record = existing_records.get(student.id) %}
                                {% set school_day_record = school_day_records.get(student.id) %}
                <div class="col-12 col-md-6 col-xl-4">
                    <div class="student-attendance-card" data-student-id="{{ student.id }}">
                        <div class="student-card-header">
                            <div class="student-avatar">
                                {{ student.first_name[0] }}{{ student.last_name[0] }}
                            </div>
                            <div class="student-info">
                                <h6 class="student-name mb-0">{{ student.first_name }} {{ student.last_name }}</h6>
                                <small class="student-id">ID: {{ student.student_id }}</small>
                            </div>
                                        {% if school_day_record %}
                                <div class="school-day-badge">
                                            {% if school_day_record.status == 'Present' %}
                                        <span class="badge bg-success" title="School Day Status">
                                            <i class="bi bi-check-circle-fill"></i>
                                        </span>
                                            {% elif school_day_record.status == 'Absent' %}
                                        <span class="badge bg-danger" title="School Day Status">
                                            <i class="bi bi-x-circle-fill"></i>
                                        </span>
                                            {% elif school_day_record.status == 'Late' %}
                                        <span class="badge bg-warning" title="School Day Status">
                                            <i class="bi bi-clock-fill"></i>
                                        </span>
                                            {% else %}
                                        <span class="badge bg-info" title="School Day Status">
                                            <i class="bi bi-info-circle-fill"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                            {% endif %}
                        </div>
                        
                        <div class="student-card-body">
                            <div class="attendance-buttons">
                                {% for status in statuses %}
                                    <input type="radio" class="btn-check" name="status_{{ student.id }}" 
                                           id="status-{{ student.id }}-{{ loop.index }}" 
                                           value="{{ status|lower }}" 
                                           {% if record and record.status == status|lower %}checked{% endif %} 
                                           required>
                                    <label class="btn btn-attendance btn-attendance-{{ status|lower|replace(' ', '-') }}" 
                                           for="status-{{ student.id }}-{{ loop.index }}">
                                        {% if status == 'Present' %}
                                            <i class="bi bi-check-circle-fill"></i>
                                        {% elif status == 'Late' %}
                                            <i class="bi bi-clock-fill"></i>
                                        {% elif status == 'Excused Absence' %}
                                            <i class="bi bi-file-medical-fill"></i>
                                        {% elif status == 'Unexcused Absence' %}
                                            <i class="bi bi-x-circle-fill"></i>
                                        {% elif status == 'Suspended' %}
                                            <i class="bi bi-ban"></i>
                                        {% else %}
                                            <i class="bi bi-x-circle-fill"></i>
                                        {% endif %}
                                        <span>{{ status }}</span>
                                                </label>
                                            {% endfor %}
                                        </div>
                            
                            <div class="notes-section mt-3">
                                <input type="text" class="form-control form-control-sm notes-input" 
                                       name="notes_{{ student.id }}" 
                                       placeholder="Add note (optional)" 
                                       value="{{ record.notes if record else '' }}">
                </div>
                        </div>
                    </div>
                        </div>
            {% else %}
                <div class="col-12">
                    <div class="alert alert-info text-center">
                        <i class="bi bi-info-circle me-2"></i>
                        No students enrolled in this class.
                    </div>
                </div>
            {% endfor %}
                </div>
                
        <!-- Save Button -->
        <div class="card border-0 shadow-sm sticky-bottom">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h6 class="mb-0">Ready to submit?</h6>
                        <small class="text-muted" id="completionStatus">
                            <span id="markedCount">{{ existing_records|length }}</span> of {{ students|length }} students marked
                        </small>
                    </div>
                    <button type="submit" class="btn btn-success btn-lg px-5" id="saveAttendanceBtn">
                        <i class="bi bi-save me-2"></i>Save Attendance
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Bulk Upload Modal -->
<div class="modal fade" id="bulkUploadModal" tabindex="-1" aria-labelledby="bulkUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="bulkUploadModalLabel">
                    <i class="bi bi-cloud-upload-fill me-2"></i>Bulk Upload Attendance
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('teacher.attendance.upload_attendance_csv', class_id=class_item.id) }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-body">
                    <div class="alert alert-info border-0 mb-4">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-info-circle me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-2">How to use Bulk Upload:</h6>
                                <ol class="mb-0 ps-3 small">
                                    <li>Click <strong>"Download Template"</strong> to get a CSV file pre-filled with your class roster</li>
                                    <li>Open the CSV in Excel, Google Sheets, or any spreadsheet program</li>
                                    <li>Fill in attendance data for past dates (format: MM/DD/YYYY)</li>
                                    <li>Delete the instruction rows (starting with #)</li>
                                    <li>Save and upload the file here</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">
                            <i class="bi bi-clipboard-check me-2 text-primary"></i>Valid Attendance Statuses:
                        </h6>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-success">Present</span>
                            <span class="badge bg-warning">Late</span>
                            <span class="badge bg-danger">Unexcused Absence</span>
                            <span class="badge bg-info">Excused Absence</span>
                            <span class="badge bg-secondary">Suspended</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="attendance_file" class="form-label fw-semibold">
                            <i class="bi bi-file-earmark-spreadsheet me-2"></i>Select CSV File
                        </label>
                        <input type="file" class="form-control form-control-lg" id="attendance_file" name="attendance_file" accept=".csv" required>
                        <div class="form-text">
                            <i class="bi bi-exclamation-circle me-1"></i>
                            Only CSV files are accepted. Max file size: 5MB
                        </div>
                    </div>
                    
                    <div class="alert alert-warning border-0">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-exclamation-triangle me-3 fs-5"></i>
                            <div class="small">
                                <strong>Important:</strong>
                                <ul class="mb-0 ps-3 mt-2">
                                    <li>This will add or <strong>update existing</strong> attendance records</li>
                                    <li>Student IDs must match exactly</li>
                                    <li>Cannot upload attendance for future dates</li>
                                    <li>Only students currently enrolled in <strong>{{ class_item.name }}</strong> will be processed</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-upload me-1"></i>Upload Attendance Data
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
// Global variables
const totalStudents = {{ students|length }};

// Global updateStats function so it can be called from anywhere
function updateStats() {
    console.log('updateStats() called');
    
    // More specific selectors for attendance status radio buttons
    const presentCount = document.querySelectorAll('input[name^="status_"][value="present"]:checked').length;
    const lateCount = document.querySelectorAll('input[name^="status_"][value="late"]:checked').length;
    const excusedCount = document.querySelectorAll('input[name^="status_"][value="excused absence"]:checked').length;
    const unexcusedCount = document.querySelectorAll('input[name^="status_"][value="unexcused absence"]:checked').length;
    const suspendedCount = document.querySelectorAll('input[name^="status_"][value="suspended"]:checked').length;
    const absentCount = excusedCount + unexcusedCount;
    const markedCount = presentCount + lateCount + absentCount + suspendedCount;
    
    const attendanceRate = totalStudents > 0 ? Math.round((presentCount / totalStudents) * 100) : 0;
    
    console.log('Counts:', {
        present: presentCount,
        late: lateCount,
        absent: absentCount,
        rate: attendanceRate,
        marked: markedCount,
        total: totalStudents
    });
    
    // Update stat cards directly (no animation)
    const presentEl = document.getElementById('presentCount');
    const lateEl = document.getElementById('lateCount');
    const absentEl = document.getElementById('absentCount');
    const rateEl = document.getElementById('attendanceRate');
    
    if (presentEl && lateEl && absentEl && rateEl) {
        console.log('Updating elements directly...');
        presentEl.textContent = presentCount;
        lateEl.textContent = lateCount;
        absentEl.textContent = absentCount;
        rateEl.textContent = attendanceRate + '%';
        console.log('Elements updated successfully');
    } else {
        console.error('Could not find stat elements:', {
            presentEl: !!presentEl,
            lateEl: !!lateEl,
            absentEl: !!absentEl,
            rateEl: !!rateEl
        });
    }
    
    // Update completion status
    const markedCountEl = document.getElementById('markedCount');
    if (markedCountEl) {
        markedCountEl.textContent = markedCount;
    }
}

// Animation function
    function animateValue(id, start, end) {
        const element = document.getElementById(id);
        if (!element) {
            console.error('Element not found:', id);
            return;
        }
        
        // Direct update - skip animation for now to ensure it works
        if (id === 'attendanceRate') {
            element.textContent = end + '%';
        } else {
            element.textContent = end;
        }
        
        // Original animation code commented out for debugging
        /*
        const duration = 300;
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                element.textContent = id === 'attendanceRate' ? end + '%' : end;
                clearInterval(timer);
            } else {
                element.textContent = id === 'attendanceRate' ? Math.round(current) + '%' : Math.round(current);
            }
        }, 16);
        */
    }

// DOM Ready handler
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('attendanceForm');
    const saveBtn = document.getElementById('saveAttendanceBtn');
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        const checkedStudents = document.querySelectorAll('input[type="radio"]:checked').length;
        
        if (checkedStudents < totalStudents) {
            e.preventDefault();
            const missing = totalStudents - checkedStudents;
            alert(`⚠️ Please mark attendance for all students.\n\n${missing} student(s) still need attendance status.`);
            return false;
        }
        
        // Show loading state
        saveBtn.classList.add('btn-loading');
        saveBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Saving...';
        saveBtn.disabled = true;
    });
    
    // Real-time statistics update
    const radioButtons = document.querySelectorAll('input[type="radio"][name^="status_"]');
    const attendanceLabels = document.querySelectorAll('.btn-attendance');
    
    console.log('Found radio buttons:', radioButtons.length);
    console.log('Found attendance labels:', attendanceLabels.length);
    
    // Add change event listeners to radio buttons
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            console.log('Radio changed:', this.name, '=', this.value);
            updateStats();
        });
    });
    
    // Also add click event listeners to labels for Bootstrap btn-check pattern
    attendanceLabels.forEach(label => {
        label.addEventListener('click', function() {
            console.log('Label clicked:', this.textContent.trim());
            // Small delay to allow radio button to update
            setTimeout(updateStats, 100);
        });
    });
    
    // Initialize stats on page load
    setTimeout(function() {
        updateStats();
    }, 100);
});

// Quick action functions
function markAll(status) {
    const radios = document.querySelectorAll(`input[type="radio"][value="${status}"]`);
    radios.forEach(radio => {
        radio.checked = true;
        // Trigger change event for stats update
        radio.dispatchEvent(new Event('change', { bubbles: true }));
    });
    // Force stats update after bulk operation
    setTimeout(function() {
        if (typeof updateStats === 'function') {
            updateStats();
        }
    }, 100);
}

function clearAll() {
    if (confirm('Are you sure you want to clear all attendance selections?')) {
        const radios = document.querySelectorAll('input[type="radio"]:checked');
        radios.forEach(radio => {
            radio.checked = false;
        });
        // Force stats update after clearing
        setTimeout(function() {
            if (typeof updateStats === 'function') {
                updateStats();
            }
        }, 100);
    }
}

// Date helper functions
function setToday() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;
    // Auto-submit the form
    document.getElementById('date').closest('form').submit();
}

function setYesterday() {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    document.getElementById('date').value = yesterday.toISOString().split('T')[0];
    // Auto-submit the form
    document.getElementById('date').closest('form').submit();
}

// Auto-submit when date changes
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('date');
    if (dateInput) {
        dateInput.addEventListener('change', function() {
            // Auto-submit when date is manually changed
            this.closest('form').submit();
        });
    }
});
</script>

<!-- Bulk Upload Modal -->
<div class="modal fade" id="bulkUploadModal" tabindex="-1" aria-labelledby="bulkUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="bulkUploadModalLabel">
                    <i class="bi bi-cloud-upload-fill me-2"></i>Bulk Upload Attendance
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('teacher.attendance.upload_attendance_csv', class_id=class_item.id) }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-body">
                    <div class="alert alert-info border-0 mb-4">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-info-circle me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-2">How to use Bulk Upload:</h6>
                                <ol class="mb-0 ps-3 small">
                                    <li>Click <strong>"Download Template"</strong> below to get a CSV file with your class roster</li>
                                    <li>Open the CSV in Excel, Google Sheets, or any spreadsheet program</li>
                                    <li>Fill in attendance data for past dates (format: MM/DD/YYYY)</li>
                                    <li>Use valid status values (see below)</li>
                                    <li>Delete the instruction rows (starting with #)</li>
                                    <li>Save and upload the file here</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">
                            <i class="bi bi-clipboard-check me-2 text-primary"></i>Valid Attendance Statuses:
                        </h6>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-success fs-6 p-2">Present</span>
                            <span class="badge bg-warning text-dark fs-6 p-2">Late</span>
                            <span class="badge bg-danger fs-6 p-2">Unexcused Absence</span>
                            <span class="badge bg-info fs-6 p-2">Excused Absence</span>
                            <span class="badge bg-secondary fs-6 p-2">Suspended</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="attendance_file" class="form-label fw-semibold">
                            <i class="bi bi-file-earmark-spreadsheet me-2"></i>Select CSV File
                        </label>
                        <input type="file" class="form-control form-control-lg" id="attendance_file" name="attendance_file" accept=".csv" required>
                        <div class="form-text">
                            <i class="bi bi-exclamation-circle me-1"></i>
                            Only CSV files are accepted. Max file size: 5MB
                        </div>
                    </div>
                    
                    <div class="alert alert-warning border-0">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-exclamation-triangle me-3 fs-5"></i>
                            <div class="small">
                                <strong>Important Notes:</strong>
                                <ul class="mb-0 ps-3 mt-2">
                                    <li>This will <strong>add new</strong> or <strong>update existing</strong> attendance records</li>
                                    <li>Student IDs must match exactly (case-sensitive)</li>
                                    <li>Cannot upload attendance for future dates</li>
                                    <li>Only students currently enrolled in <strong>{{ class_item.name }}</strong> will be processed</li>
                                    <li>First, download the template to see the correct format and enrolled students</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="{{ url_for('teacher.attendance.download_attendance_template', class_id=class_item.id) }}" 
                       class="btn btn-outline-primary me-auto">
                        <i class="bi bi-download me-1"></i>Download Template
                    </a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-upload me-1"></i>Upload Attendance Data
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
