{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Grades for Class: {{ class_item.name }}</h3>
    {# Use role_prefix to go back to the correct classes list #}
    <a href="{{ url_for('management.classes') }}" class="btn btn-outline-secondary btn-sm">Back to Classes List</a>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      Class Details
    </div>
    <div class="card-body">
      <h5 class="card-title">{{ class_item.name }} ({{ class_item.class_code }})</h5>
      <p class="card-text"><strong>Subject:</strong> {{ class_item.subject }}</p>
      <p class="card-text"><strong>Grade Level:</strong> {{ class_item.grade_level }}</p>
      <p class="card-text"><strong>Teacher:</strong> {{ class_item.teacher.name if class_item.teacher else 'N/A' }}</p>
      <p class="card-text"><strong>Enrolled Students:</strong> {{ students_in_class|length }}</p>
    </div>
  </div>

  <h4>Student Grades Overview</h4>
  {% if students_in_class and assignments_in_class %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Student Name</th>
            {% for assignment in assignments_in_class %}
              <th title="{{ assignment.description }} ({{ assignment.points_possible }} pts)">{{ assignment.title }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for student_name, student_data in grades_data.items() %}
            <tr>
              <td>{{ student_data.student_obj.first_name }} {{ student_data.student_obj.last_name }}</td>
              {% for assignment in assignments_in_class %}
                <td>{{ student_data.grades[assignment.title] }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% elif students_in_class and not assignments_in_class %}
    <p>No assignments have been created for this class yet.</p>
  {% else %}
    <p>No students are enrolled in this class, or no assignments exist.</p>
  {% endif %}

{% endblock %}