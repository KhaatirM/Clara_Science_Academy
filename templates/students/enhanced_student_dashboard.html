{% extends "shared/dashboard_layout.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-gradient-primary text-white">
                <div class="card-body p-4">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <div class="mb-3 mb-md-0">
                            <h2 class="mb-2 fw-bold">
                                <i class="fas fa-graduation-cap me-3 text-warning"></i>
                                Welcome back, {{ student.first_name }}!
                            </h2>
                            <p class="mb-0 opacity-75">
                                <i class="fas fa-calendar-alt me-2"></i>
                                {{ today.strftime('%A, %B %d, %Y') }} • {{ school_year.name if school_year else 'Current School Year' }}
                            </p>
                        </div>
                        <div class="d-flex gap-2">
                            <div class="text-center">
                                <div class="fs-2 fw-bold">{{ "%.2f"|format(gpa) if gpa else '0.00' }}</div>
                                <small class="opacity-75">GPA</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Row -->
    <div class="row g-3 g-md-4 mb-4">
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center p-3">
                    <div class="bg-success bg-opacity-10 rounded-circle p-3 d-inline-block mb-2">
                        <i class="fas fa-book text-success fs-4"></i>
                    </div>
                    <h5 class="mb-1 fw-bold">{{ classes|length if classes else 0 }}</h5>
                    <small class="text-muted">Enrolled Classes</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center p-3">
                    <div class="bg-warning bg-opacity-10 rounded-circle p-3 d-inline-block mb-2">
                        <i class="fas fa-tasks text-warning fs-4"></i>
                    </div>
                    <h5 class="mb-1 fw-bold">{{ upcoming_assignments|length if upcoming_assignments else 0 }}</h5>
                    <small class="text-muted">Upcoming Assignments</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center p-3">
                    <div class="bg-danger bg-opacity-10 rounded-circle p-3 d-inline-block mb-2">
                        <i class="fas fa-exclamation-triangle text-danger fs-4"></i>
                    </div>
                    <h5 class="mb-1 fw-bold">{{ past_due_assignments|length if past_due_assignments else 0 }}</h5>
                    <small class="text-muted">Past Due</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center p-3">
                    <div class="bg-info bg-opacity-10 rounded-circle p-3 d-inline-block mb-2">
                        <i class="fas fa-chart-line text-info fs-4"></i>
                    </div>
                    <h5 class="mb-1 fw-bold">{{ attendance_summary.Present if attendance_summary else 0 }}</h5>
                    <small class="text-muted">Days Present</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row g-4">
        <!-- Today's Schedule -->
        <div class="col-12 col-lg-6">
            <div class="card border-0 shadow-lg h-100">
                <div class="card-header bg-gradient-success text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i class="fas fa-calendar-day text-white fs-4"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Today's Schedule</h5>
                            <small class="opacity-75">{{ today.strftime('%A, %B %d') }}</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% if today_schedule %}
                        {% for item in today_schedule %}
                        <div class="d-flex align-items-center mb-3 p-3 bg-light rounded-3">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                <i class="fas fa-clock text-primary"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">{{ item.class.name }}</h6>
                                <small class="text-muted">{{ item.time }} • {{ item.room }}</small>
                            </div>
                            <div class="text-end">
                                <small class="text-muted">{{ item.teacher }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-calendar-times text-muted fs-1 mb-3"></i>
                            <p class="text-muted mb-0">No classes scheduled for today</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recent Grades -->
        <div class="col-12 col-lg-6">
            <div class="card border-0 shadow-lg h-100">
                <div class="card-header bg-gradient-info text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i class="fas fa-star text-white fs-4"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Recent Grades</h5>
                            <small class="opacity-75">Latest feedback</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% if recent_grades %}
                        {% for grade in recent_grades %}
                        <div class="d-flex align-items-center mb-3 p-3 bg-light rounded-3">
                            <div class="bg-success bg-opacity-10 rounded-circle p-2 me-3">
                                <i class="fas fa-check-circle text-success"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">{{ grade.assignment.title }}</h6>
                                <small class="text-muted">{{ grade.class_name }}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-success bg-opacity-20 text-success border border-success fs-6">
                                    {{ grade.score }}%
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-star text-muted fs-1 mb-3"></i>
                            <p class="text-muted mb-0">No recent grades</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Urgent Assignments -->
        {% if past_due_assignments %}
        <div class="col-12">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-gradient-danger text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i class="fas fa-exclamation-triangle text-white fs-4"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Urgent: Past Due Assignments</h5>
                            <small class="opacity-75">Complete these immediately</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        {% for assignment in past_due_assignments[:3] %}
                        <div class="col-12 col-md-4">
                            <div class="card border-danger border-2 h-100">
                                <div class="card-body p-3">
                                    <h6 class="card-title text-danger fw-bold">{{ assignment.title }}</h6>
                                    <p class="card-text small text-muted">{{ assignment.class_info.name }}</p>
                                    <small class="text-danger">
                                        <i class="fas fa-clock me-1"></i>
                                        Due: {{ assignment.due_date.strftime('%m/%d/%Y') if assignment.due_date else 'No due date' }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Upcoming Assignments -->
        {% if upcoming_assignments %}
        <div class="col-12">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-gradient-warning text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i class="fas fa-clock text-white fs-4"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Upcoming Assignments</h5>
                            <small class="opacity-75">Due within 7 days</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        {% for assignment in upcoming_assignments[:6] %}
                        <div class="col-12 col-md-4">
                            <div class="card border-warning border-2 h-100">
                                <div class="card-body p-3">
                                    <h6 class="card-title text-warning fw-bold">{{ assignment.title }}</h6>
                                    <p class="card-text small text-muted">{{ assignment.class_info.name }}</p>
                                    <small class="text-warning">
                                        <i class="fas fa-clock me-1"></i>
                                        Due: {{ assignment.due_date.strftime('%m/%d/%Y') if assignment.due_date else 'No due date' }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Announcements -->
        {% if announcements %}
        <div class="col-12">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-gradient-primary text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i class="fas fa-bullhorn text-white fs-4"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Announcements</h5>
                            <small class="opacity-75">Important updates</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% for announcement in announcements[:3] %}
                    <div class="d-flex align-items-start mb-3 p-3 bg-light rounded-3">
                        <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                            <i class="fas fa-info-circle text-primary"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold">{{ announcement.title }}</h6>
                            <p class="mb-1 text-muted">{{ announcement.content[:150] }}{% if announcement.content|length > 150 %}...{% endif %}</p>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                {{ announcement.timestamp.strftime('%m/%d/%Y at %I:%M %p') }}
                            </small>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Enhanced Visual Styling -->

{% endblock %}
