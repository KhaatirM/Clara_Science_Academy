{% extends "dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h3 class="mb-2 mb-md-0"><i class="bi bi-list-check me-2"></i>Add Feedback Criteria</h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('teacher.view_360_feedback', session_id=feedback_session.id) }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Back to Session
      </a>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>Criteria Details</h5>
        </div>
        <div class="card-body">
          <form method="POST" id="criteriaForm">
        { csrf_token() }
            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-info-circle me-2"></i>Basic Information
                </h6>
              </div>
              <div class="col-12">
                <label for="criteria_name" class="form-label">Criteria Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="criteria_name" name="criteria_name" required placeholder="Enter the name of this feedback criteria">
                <div class="form-text">A clear, descriptive name for this feedback criteria</div>
              </div>
              <div class="col-12">
                <label for="criteria_description" class="form-label">Description</label>
                <textarea class="form-control" id="criteria_description" name="criteria_description" rows="3" placeholder="Provide additional context about this criteria..."></textarea>
                <div class="form-text">Optional description to help respondents understand what to evaluate</div>
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-gear me-2"></i>Criteria Settings
                </h6>
              </div>
              <div class="col-12 col-md-6">
                <label for="criteria_type" class="form-label">Response Type <span class="text-danger">*</span></label>
                <select class="form-select" id="criteria_type" name="criteria_type" required onchange="toggleScaleSettings()">
                  <option value="rating">Rating (1-5 scale)</option>
                  <option value="scale">Custom Scale</option>
                  <option value="text">Text Response</option>
                </select>
                <div class="form-text">Choose how respondents will provide feedback</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="order_index" class="form-label">Display Order</label>
                <input type="number" class="form-control" id="order_index" name="order_index" value="0" min="0">
                <div class="form-text">Order in which this criteria appears (0 = first)</div>
              </div>
            </div>

            <div class="row g-3 mb-4" id="scaleSettings">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-sliders me-2"></i>Scale Settings
                </h6>
              </div>
              <div class="col-12 col-md-6">
                <label for="scale_min" class="form-label">Minimum Value</label>
                <input type="number" class="form-control" id="scale_min" name="scale_min" value="1" min="0">
                <div class="form-text">Lowest value on the scale</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="scale_max" class="form-label">Maximum Value</label>
                <input type="number" class="form-control" id="scale_max" name="scale_max" value="5" min="1">
                <div class="form-text">Highest value on the scale</div>
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-check-circle me-2"></i>Requirements
                </h6>
              </div>
              <div class="col-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="is_required" name="is_required" checked>
                  <label class="form-check-label" for="is_required">
                    Required Response
                  </label>
                  <div class="form-text">Students must provide feedback for this criteria</div>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save me-1"></i>Create Criteria
              </button>
              <a href="{{ url_for('teacher.view_360_feedback', session_id=feedback_session.id) }}" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle me-1"></i>Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Help Panel -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Response Types</h6>
        </div>
        <div class="card-body">
          <h6>Rating (1-5 scale)</h6>
          <p class="small mb-3">Standard 1-5 rating scale for quick, quantitative feedback.</p>
          
          <h6>Custom Scale</h6>
          <p class="small mb-3">Define your own scale range (e.g., 1-10, 0-100) for specific needs.</p>
          
          <h6>Text Response</h6>
          <p class="small mb-3">Open-ended text feedback for detailed, qualitative responses.</p>
          
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Tip:</strong> Mix rating and text criteria for comprehensive feedback.
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-success text-white">
          <h6 class="mb-0"><i class="bi bi-star me-2"></i>Criteria Examples</h6>
        </div>
        <div class="card-body">
          <ul class="mb-0 small">
            <li><strong>Collaboration:</strong> "How well does this student work with others?"</li>
            <li><strong>Communication:</strong> "Rate the clarity of this student's communication"</li>
            <li><strong>Leadership:</strong> "Does this student take initiative in group work?"</li>
            <li><strong>Problem Solving:</strong> "How effectively does this student solve problems?"</li>
            <li><strong>Reliability:</strong> "Can you count on this student to complete tasks?"</li>
            <li><strong>Creativity:</strong> "How creative is this student in their approach?"</li>
          </ul>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-warning text-white">
          <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Quick Templates</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCriteriaTemplate('collaboration')">
              <i class="bi bi-people me-1"></i>Collaboration
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" onclick="setCriteriaTemplate('communication')">
              <i class="bi bi-chat-dots me-1"></i>Communication
            </button>
            <button type="button" class="btn btn-outline-info btn-sm" onclick="setCriteriaTemplate('leadership')">
              <i class="bi bi-trophy me-1"></i>Leadership
            </button>
            <button type="button" class="btn btn-outline-warning btn-sm" onclick="setCriteriaTemplate('reliability')">
              <i class="bi bi-shield-check me-1"></i>Reliability
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Toggle scale settings based on criteria type
function toggleScaleSettings() {
    const criteriaType = document.getElementById('criteria_type').value;
    const scaleSettings = document.getElementById('scaleSettings');
    
    if (criteriaType === 'text') {
        scaleSettings.style.display = 'none';
    } else {
        scaleSettings.style.display = 'block';
    }
}

// Set criteria templates
function setCriteriaTemplate(type) {
    const nameField = document.getElementById('criteria_name');
    const descriptionField = document.getElementById('criteria_description');
    const typeField = document.getElementById('criteria_type');
    
    switch(type) {
        case 'collaboration':
            nameField.value = 'Collaboration Skills';
            descriptionField.value = 'How well does this student work with others? Consider teamwork, sharing ideas, and supporting group members.';
            typeField.value = 'rating';
            break;
            
        case 'communication':
            nameField.value = 'Communication Skills';
            descriptionField.value = 'Rate the clarity and effectiveness of this student\'s communication. Consider both verbal and written communication.';
            typeField.value = 'rating';
            break;
            
        case 'leadership':
            nameField.value = 'Leadership Qualities';
            descriptionField.value = 'Does this student demonstrate leadership skills? Consider initiative, decision-making, and ability to guide others.';
            typeField.value = 'rating';
            break;
            
        case 'reliability':
            nameField.value = 'Reliability and Dependability';
            descriptionField.value = 'Can you count on this student to complete tasks on time and to the best of their ability?';
            typeField.value = 'rating';
            break;
    }
    
    // Trigger the change event to show/hide appropriate sections
    document.getElementById('criteria_type').dispatchEvent(new Event('change'));
}

// Initialize the display based on current criteria type
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('criteria_type').dispatchEvent(new Event('change'));
});
</script>
{% endblock %}

