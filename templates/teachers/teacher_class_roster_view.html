{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
  <!-- Modern Header -->
  <div class="teacher-class-header mb-4">
    <div class="teacher-class-header-content">
      <div class="teacher-class-title-section">
        <h1 class="teacher-class-title">
          <i class="bi bi-mortarboard me-3"></i>{{ class_item.name }}
        </h1>
        <p class="teacher-class-subtitle">{{ class_item.subject }} • {{ class_item.grade_level or 'All Grades' }}</p>
      </div>
      <a href="{{ url_for('teacher.my_classes') }}" class="btn-teacher-class-back">
        <i class="bi bi-arrow-left me-2"></i>Back to My Classes
      </a>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="teacher-class-stat-card">
        <div class="teacher-class-stat-icon">
          <i class="bi bi-people-fill"></i>
        </div>
        <div class="teacher-class-stat-content">
          <div class="teacher-class-stat-number">{{ enrolled_students|length }}</div>
          <div class="teacher-class-stat-label">Students</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="teacher-class-stat-card">
        <div class="teacher-class-stat-icon">
          <i class="bi bi-journal-text"></i>
        </div>
        <div class="teacher-class-stat-content">
          <div class="teacher-class-stat-number">{{ assignments|length }}</div>
          <div class="teacher-class-stat-label">Assignments</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="teacher-class-stat-card">
        <div class="teacher-class-stat-icon">
          <i class="bi bi-calendar-check"></i>
        </div>
        <div class="teacher-class-stat-content">
          <div class="teacher-class-stat-number">{{ recent_attendance|length }}</div>
          <div class="teacher-class-stat-label">Recent Records</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="teacher-class-stat-card">
        <div class="teacher-class-stat-icon">
          <i class="bi bi-megaphone"></i>
        </div>
        <div class="teacher-class-stat-content">
          <div class="teacher-class-stat-number">{{ announcements|length }}</div>
          <div class="teacher-class-stat-label">Announcements</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4" style="align-items: start;">
    <!-- Left Column: Class Info & Management -->
    <div class="col-12 col-lg-4" style="align-self: start;">
      <!-- Class Information Card -->
      <div class="teacher-class-card-modern mb-4">
        <div class="teacher-class-card-header">
          <div class="teacher-class-card-icon">
            <i class="bi bi-info-circle"></i>
          </div>
          <div class="teacher-class-card-title-section">
            <h5 class="teacher-class-card-title">Class Information</h5>
            <p class="teacher-class-card-subject">Course Details</p>
          </div>
        </div>
        <div class="teacher-class-card-body" style="padding: 0.75rem;">
          <div class="teacher-class-info-section" style="display: flex; flex-direction: column; gap: 0.5rem;">
            <div class="teacher-class-info-item" style="margin-bottom: 0; padding: 0.25rem 0;">
              <i class="bi bi-book me-2"></i>
              <strong>Subject:</strong> {{ class_item.subject }}
            </div>
            <div class="teacher-class-info-item" style="margin-bottom: 0; padding: 0.25rem 0;">
              <i class="bi bi-mortarboard me-2"></i>
              <strong>Grade Level:</strong> {{ class_item.grade_level or 'N/A' }}
            </div>
            <div class="teacher-class-info-item" style="margin-bottom: 0; padding: 0.25rem 0;">
              <i class="bi bi-door-open me-2"></i>
              <strong>Room:</strong> {{ class_item.room_number if class_item.room_number else 'N/A' }}
            </div>
            <div class="teacher-class-info-item" style="margin-bottom: 0; padding: 0.25rem 0;">
              <i class="bi bi-clock me-2"></i>
              <strong>Schedule:</strong> {{ class_item.schedule_info if class_item.schedule_info else 'TBD' }}
            </div>
            <div class="teacher-class-info-item" style="margin-bottom: 0; padding: 0.25rem 0;">
              <i class="bi bi-calendar3 me-2"></i>
              <strong>School Year:</strong> {{ class_item.school_year.name if class_item.school_year else 'N/A' }}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Class Management Card -->
      <div class="teacher-class-card-modern mb-4">
        <div class="teacher-class-card-header">
          <div class="teacher-class-card-icon">
            <i class="bi bi-tools"></i>
          </div>
          <div class="teacher-class-card-title-section">
            <h5 class="teacher-class-card-title">Class Management</h5>
            <p class="teacher-class-card-subject">Quick Actions</p>
          </div>
        </div>
        <div class="teacher-class-card-body" style="padding: 0.75rem;">
          <!-- Core Management Actions -->
          <div class="mb-2">
            <h6 class="teacher-class-section-title">
              <i class="bi bi-gear me-2"></i>Core Management
            </h6>
            <div class="row g-2">
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.assignment_type_selector') }}" class="btn-teacher-class-action">
                  <i class="bi bi-plus-circle me-1"></i>Add Assignment
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.take_attendance', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-clipboard-check me-1"></i>Take Attendance
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_groups', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-people me-1"></i>Manage Groups
                </a>
              </div>
            </div>
          </div>
          
          <!-- Group Work & Assignments -->
          <div class="mb-2">
            <h6 class="teacher-class-section-title">
              <i class="bi bi-people-fill me-2"></i>Group Work & Assignments
            </h6>
            <div class="row g-2">
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_group_assignments', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-journal-plus me-1"></i>Group Assignments
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_deadline_reminders', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-bell me-1"></i>Deadline Reminders
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_reports', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-graph-up me-1"></i>Reports & Analytics
                </a>
              </div>
            </div>
          </div>
          
          <!-- Assessment & Feedback -->
          <div>
            <h6 class="teacher-class-section-title">
              <i class="bi bi-star me-2"></i>Assessment & Feedback
            </h6>
            <div class="row g-2">
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_360_feedback', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-arrow-repeat me-1"></i>360° Feedback
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_reflection_journals', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-journal-text me-1"></i>Reflection Journals
                </a>
              </div>
              <div class="col-6 col-md-4">
                <a href="{{ url_for('teacher.class_conflicts', class_id=class_item.id) }}" class="btn-teacher-class-action">
                  <i class="bi bi-exclamation-triangle me-1"></i>Conflict Resolution
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Announcements Card -->
      <div class="teacher-class-card-modern mb-4">
        <div class="teacher-class-card-header">
          <div class="teacher-class-card-icon">
            <i class="bi bi-megaphone"></i>
          </div>
          <div class="teacher-class-card-title-section">
            <h5 class="teacher-class-card-title">Recent Announcements</h5>
            <p class="teacher-class-card-subject">Latest Updates</p>
          </div>
        </div>
        <div class="teacher-class-card-body" style="max-height: 200px; overflow-y: auto; padding: 0.75rem;">
          {% if announcements %}
            <div class="teacher-class-announcements">
              {% for ann in announcements %}
                <div class="teacher-class-announcement-item">
                  <div class="teacher-class-announcement-header">
                    <h6 class="teacher-class-announcement-title">{{ ann.title }}</h6>
                    <small class="teacher-class-announcement-date">{{ ann.timestamp.strftime('%b %d, %Y %I:%M %p') }}</small>
                  </div>
                  <p class="teacher-class-announcement-message">{{ ann.message[:100] }}{% if ann.message|length > 100 %}...{% endif %}</p>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="teacher-class-empty-state">
              <i class="bi bi-megaphone"></i>
              <p>No recent announcements.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Main Content: Students, Assignments, Attendance -->
    <div class="col-12 col-lg-8">
      <div class="row g-4">
        <!-- Enrolled Students Card -->
        <div class="col-12 col-md-6">
          <div class="teacher-class-card-modern">
            <div class="teacher-class-card-header">
              <div class="teacher-class-card-icon">
                <i class="bi bi-people-fill"></i>
              </div>
              <div class="teacher-class-card-title-section">
                <h5 class="teacher-class-card-title">Enrolled Students</h5>
                <p class="teacher-class-card-subject">{{ enrolled_students|length }} Students</p>
              </div>
            </div>
            <div class="teacher-class-card-body" style="max-height: 400px; overflow-y: auto;">
              {% if enrolled_students %}
                <div class="teacher-class-students-list">
                  {% for student in enrolled_students %}
                    <div class="teacher-class-student-item">
                      <div class="teacher-class-student-avatar">
                        {% if student.photo_filename %}
                          <img src="{{ url_for('static', filename='uploads/' ~ student.photo_filename) }}" alt="Student Photo">
                        {% else %}
                          <span>{{ student.first_name[0] }}{{ student.last_name[0] }}</span>
                        {% endif %}
                      </div>
                      <div class="teacher-class-student-info">
                        <div class="teacher-class-student-name">{{ student.first_name }} {{ student.last_name }}</div>
                        <div class="teacher-class-student-id">ID: {{ student.student_id or 'N/A' }}</div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="teacher-class-empty-state">
                  <i class="bi bi-people"></i>
                  <p>No students are currently enrolled in this class.</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Recent Assignments Card -->
        <div class="col-12 col-md-6">
          <div class="teacher-class-card-modern">
            <div class="teacher-class-card-header">
              <div class="teacher-class-card-icon">
                <i class="bi bi-journal-text"></i>
              </div>
              <div class="teacher-class-card-title-section">
                <h5 class="teacher-class-card-title">Recent Assignments</h5>
                <p class="teacher-class-card-subject">{{ assignments|length }} Assignments</p>
              </div>
            </div>
            <div class="teacher-class-card-body" style="max-height: 400px; overflow-y: auto;">
              {% if assignments %}
                <div class="teacher-class-assignments-list">
                  {% for assignment in assignments %}
                    <div class="teacher-class-assignment-item">
                      <div class="teacher-class-assignment-header">
                        <h6 class="teacher-class-assignment-title">{{ assignment.title }}</h6>
                        {% if assignment.due_date %}
                          <span class="teacher-class-assignment-due">Due: {{ assignment.due_date.strftime('%b %d, %Y') }}</span>
                        {% else %}
                          <span class="teacher-class-assignment-due">No due date</span>
                        {% endif %}
                      </div>
                      {% if assignment.description %}
                        <p class="teacher-class-assignment-description">{{ assignment.description[:80] }}{% if assignment.description|length > 80 %}...{% endif %}</p>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="teacher-class-empty-state">
                  <i class="bi bi-journal"></i>
                  <p>No recent assignments.</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <!-- Recent Attendance Card -->
      <div class="teacher-class-card-modern mt-4">
        <div class="teacher-class-card-header">
          <div class="teacher-class-card-icon">
            <i class="bi bi-calendar-check"></i>
          </div>
          <div class="teacher-class-card-title-section">
            <h5 class="teacher-class-card-title">Recent Attendance</h5>
            <p class="teacher-class-card-subject">Last 7 Days</p>
          </div>
        </div>
        <div class="teacher-class-card-body" style="max-height: 180px; overflow-y: auto; padding: 0.75rem;">
          {% if recent_attendance %}
            <div class="teacher-class-attendance-table">
              <div class="teacher-class-attendance-header">
                <div class="teacher-class-attendance-col">Date</div>
                <div class="teacher-class-attendance-col">Student</div>
                <div class="teacher-class-attendance-col">Status</div>
                <div class="teacher-class-attendance-col">Notes</div>
              </div>
              <div class="teacher-class-attendance-body">
                {% for record in recent_attendance %}
                  <div class="teacher-class-attendance-row">
                    <div class="teacher-class-attendance-col">
                      <span class="teacher-class-attendance-date">{{ record.date.strftime('%b %d, %Y') }}</span>
                    </div>
                    <div class="teacher-class-attendance-col">
                      <span class="teacher-class-attendance-student">{{ record.student.first_name }} {{ record.student.last_name }}</span>
                    </div>
                    <div class="teacher-class-attendance-col">
                      {% set status = record.status %}
                      {% if status == 'Present' %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-present">Present</span>
                      {% elif status == 'Late' %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-late">Late</span>
                      {% elif status == 'Unexcused Absence' %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-unexcused">Unexcused</span>
                      {% elif status == 'Excused Absence' %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-excused">Excused</span>
                      {% elif status == 'Suspended' %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-suspended">Suspended</span>
                      {% else %}
                        <span class="teacher-class-attendance-badge teacher-class-attendance-other">{{ status }}</span>
                      {% endif %}
                    </div>
                    <div class="teacher-class-attendance-col">
                      <span class="teacher-class-attendance-notes">{{ record.notes or '' }}</span>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% else %}
            <div class="teacher-class-empty-state">
              <i class="bi bi-calendar-x"></i>
              <p>No recent attendance records.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
