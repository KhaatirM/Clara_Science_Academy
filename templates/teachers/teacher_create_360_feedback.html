{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h3 class="mb-2 mb-md-0"><i class="bi bi-arrow-repeat me-2"></i>Create 360-Degree Feedback Session</h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('management.admin_class_360_feedback', class_id=class_obj.id) if role_prefix else url_for('teacher.class_360_feedback', class_id=class_obj.id) }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Back to Sessions
      </a>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-arrow-repeat me-2"></i>Session Details</h5>
        </div>
        <div class="card-body">
          <form method="POST" id="feedbackForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-info-circle me-2"></i>Basic Information
                </h6>
              </div>
              <div class="col-12">
                <label for="title" class="form-label">Session Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="title" name="title" required placeholder="Enter a descriptive title for this feedback session">
                <div class="form-text">A clear title that describes the purpose of this feedback session</div>
              </div>
              <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" placeholder="Provide additional context about this feedback session..."></textarea>
                <div class="form-text">Optional description to help participants understand the purpose</div>
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-person me-2"></i>Target Student
                </h6>
              </div>
              <div class="col-12 col-md-6">
                <label for="target_student_id" class="form-label">Target Student <span class="text-danger">*</span></label>
                <select class="form-select" id="target_student_id" name="target_student_id" required>
                  <option value="">Select a student...</option>
                  {% for student in students %}
                    <option value="{{ student.id }}">{{ student.first_name }} {{ student.last_name }}</option>
                  {% endfor %}
                </select>
                <div class="form-text">The student who will receive feedback from peers</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="feedback_type" class="form-label">Feedback Type <span class="text-danger">*</span></label>
                <select class="form-select" id="feedback_type" name="feedback_type" required>
                  <option value="comprehensive">Comprehensive (Peers + Self + Teacher)</option>
                  <option value="peer_only">Peer Only</option>
                  <option value="self_only">Self-Reflection Only</option>
                </select>
                <div class="form-text">Choose the type of feedback to collect</div>
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-calendar me-2"></i>Schedule
                </h6>
              </div>
              <div class="col-12 col-md-6">
                <label for="due_date" class="form-label">Due Date (Optional)</label>
                <input type="datetime-local" class="form-control" id="due_date" name="due_date">
                <div class="form-text">When should feedback be submitted by</div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save me-1"></i>Create Session
              </button>
              <a href="{{ url_for('management.admin_class_360_feedback', class_id=class_obj.id) if role_prefix else url_for('teacher.class_360_feedback', class_id=class_obj.id) }}" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle me-1"></i>Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Help Panel -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Feedback Types</h6>
        </div>
        <div class="card-body">
          <h6>Comprehensive</h6>
          <p class="small mb-3">Collects feedback from peers, self-reflection, and teacher evaluation for a complete 360-degree view.</p>
          
          <h6>Peer Only</h6>
          <p class="small mb-3">Focuses on peer-to-peer feedback to encourage collaboration and peer learning.</p>
          
          <h6>Self-Reflection Only</h6>
          <p class="small mb-3">Encourages students to reflect on their own performance and growth.</p>
          
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Tip:</strong> Start with peer-only feedback for younger students.
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-success text-white">
          <h6 class="mb-0"><i class="bi bi-star me-2"></i>Best Practices</h6>
        </div>
        <div class="card-body">
          <ul class="mb-0 small">
            <li>Set clear expectations for feedback</li>
            <li>Encourage constructive and specific feedback</li>
            <li>Provide examples of good feedback</li>
            <li>Allow anonymous responses when appropriate</li>
            <li>Follow up with students after feedback</li>
            <li>Use feedback for growth, not just evaluation</li>
          </ul>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-warning text-white">
          <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Next Steps</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="setQuickTemplate('collaboration')">
              <i class="bi bi-people me-1"></i>Collaboration Template
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" onclick="setQuickTemplate('leadership')">
              <i class="bi bi-trophy me-1"></i>Leadership Template
            </button>
            <button type="button" class="btn btn-outline-info btn-sm" onclick="setQuickTemplate('communication')">
              <i class="bi bi-chat-dots me-1"></i>Communication Template
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Set quick templates
function setQuickTemplate(type) {
    const titleField = document.getElementById('title');
    const descriptionField = document.getElementById('description');
    const feedbackTypeField = document.getElementById('feedback_type');
    
    switch(type) {
        case 'collaboration':
            titleField.value = 'Collaboration Skills Feedback';
            descriptionField.value = 'This feedback session focuses on how well students work together in group activities. Please provide honest, constructive feedback about collaboration, communication, and teamwork skills.';
            feedbackTypeField.value = 'comprehensive';
            break;
            
        case 'leadership':
            titleField.value = 'Leadership Skills Assessment';
            descriptionField.value = 'This session evaluates leadership qualities including initiative, decision-making, and ability to guide others. Focus on specific examples and constructive suggestions.';
            feedbackTypeField.value = 'comprehensive';
            break;
            
        case 'communication':
            titleField.value = 'Communication Skills Review';
            descriptionField.value = 'This feedback session assesses communication skills including listening, speaking, and written communication. Provide specific examples and areas for improvement.';
            feedbackTypeField.value = 'peer_only';
            break;
    }
}

// Set default due date to one week from now
document.addEventListener('DOMContentLoaded', function() {
    const nextWeek = new Date();
    nextWeek.setDate(nextWeek.getDate() + 7);
    nextWeek.setHours(23, 59, 0, 0); // Set to end of day
    
    const dateInput = document.getElementById('due_date');
    dateInput.value = nextWeek.toISOString().slice(0, 16);
});
</script>
{% endblock %}

