{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h3 class="mb-2 mb-md-0"><i class="bi bi-plus-circle me-2"></i>Create Report</h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('management.admin_class_analytics', class_id=class_obj.id) if role_prefix else url_for('teacher.grading.class_reports', class_id=class_obj.id) }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Back to Reports
      </a>
    </div>
  </div>

  <!-- Class Info -->
  <div class="row g-4 mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Class Information</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <strong>Class:</strong><br>
              <span class="fw-bold">{{ class_obj.name }}</span>
            </div>
            <div class="col-12 col-md-6">
              <strong>Subject:</strong><br>
              <span class="fw-bold">{{ class_obj.subject }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Creation Form -->
  <div class="row g-4">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-file-text me-2"></i>Report Configuration</h5>
        </div>
        <div class="card-body">
          <form method="POST" id="reportForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-info-circle me-2"></i>Basic Information
                </h6>
              </div>
              <div class="col-12">
                <label for="report_name" class="form-label">Report Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="report_name" name="report_name" required placeholder="Enter a descriptive name for this report">
                <div class="form-text">A clear, descriptive name for your report</div>
              </div>
              <div class="col-12">
                <label for="report_type" class="form-label">Report Type <span class="text-danger">*</span></label>
                <select class="form-select" id="report_type" name="report_type" required>
                  <option value="">Select report type...</option>
                  <option value="comprehensive">Comprehensive Report</option>
                  <option value="performance">Performance Report</option>
                  <option value="collaboration">Collaboration Report</option>
                  <option value="individual">Individual Progress Report</option>
                </select>
                <div class="form-text">Choose the type of report to generate</div>
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-calendar me-2"></i>Report Period
                </h6>
              </div>
              <div class="col-12 col-md-6">
                <label for="report_period_start" class="form-label">Start Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="report_period_start" name="report_period_start" required>
                <div class="form-text">Beginning of the reporting period</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="report_period_end" class="form-label">End Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="report_period_end" name="report_period_end" required>
                <div class="form-text">End of the reporting period</div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-success">
                <i class="bi bi-file-earmark-text me-1"></i>Generate Report
              </button>
              <a href="{{ url_for('management.admin_class_analytics', class_id=class_obj.id) if role_prefix else url_for('teacher.grading.class_reports', class_id=class_obj.id) }}" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle me-1"></i>Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Help Panel -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Report Types</h6>
        </div>
        <div class="card-body">
          <h6>Comprehensive Report</h6>
          <p class="small mb-3">Complete overview including groups, assignments, contributions, and performance metrics.</p>
          
          <h6>Performance Report</h6>
          <p class="small mb-3">Focus on grades, scores, and academic performance indicators.</p>
          
          <h6>Collaboration Report</h6>
          <p class="small mb-3">Analysis of group dynamics, collaboration metrics, and teamwork effectiveness.</p>
          
          <h6>Individual Progress Report</h6>
          <p class="small mb-3">Detailed tracking of individual student contributions and progress.</p>
          
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Note:</strong> Report generation may take a few moments for large datasets.
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-success text-white">
          <h6 class="mb-0"><i class="bi bi-star me-2"></i>Best Practices</h6>
        </div>
        <div class="card-body">
          <ul class="mb-0 small">
            <li>Use descriptive report names for easy identification</li>
            <li>Select appropriate date ranges for meaningful insights</li>
            <li>Choose report types that match your analysis needs</li>
            <li>Generate reports regularly for trend analysis</li>
            <li>Export reports for sharing with stakeholders</li>
            <li>Review data quality before generating reports</li>
          </ul>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-header bg-warning text-white">
          <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Quick Templates</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="setReportTemplate('comprehensive')">
              <i class="bi bi-file-text me-1"></i>Comprehensive Template
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" onclick="setReportTemplate('performance')">
              <i class="bi bi-graph-up me-1"></i>Performance Template
            </button>
            <button type="button" class="btn btn-outline-info btn-sm" onclick="setReportTemplate('collaboration')">
              <i class="bi bi-people me-1"></i>Collaboration Template
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Set report templates
function setReportTemplate(type) {
    const nameField = document.getElementById('report_name');
    const typeField = document.getElementById('report_type');
    
    switch(type) {
        case 'comprehensive':
            typeField.value = 'comprehensive';
            nameField.value = 'Comprehensive Group Work Report - ' + new Date().toLocaleDateString();
            break;
            
        case 'performance':
            typeField.value = 'performance';
            nameField.value = 'Performance Analysis Report - ' + new Date().toLocaleDateString();
            break;
            
        case 'collaboration':
            typeField.value = 'collaboration';
            nameField.value = 'Collaboration Metrics Report - ' + new Date().toLocaleDateString();
            break;
    }
}

// Set default date range (last 30 days)
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
    
    const startDateInput = document.getElementById('report_period_start');
    const endDateInput = document.getElementById('report_period_end');
    
    startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
    endDateInput.value = today.toISOString().split('T')[0];
});
</script>
{% endblock %}
