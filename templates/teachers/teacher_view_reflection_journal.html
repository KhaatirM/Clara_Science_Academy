{% extends "shared/dashboard_layout.html" %}

{% block dashboard_content %}
<div class="container-fluid px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h3 class="mb-2 mb-md-0"><i class="bi bi-journal-text me-2"></i>Reflection Journal</h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('teacher.assignments.class_reflection_journals', class_id=class_obj.id) }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Back to Journals
      </a>
    </div>
  </div>

  <!-- Journal Header -->
  <div class="row g-4 mb-4">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-person me-2"></i>Student Information</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <strong>Student:</strong><br>
              <span class="fs-5">{{ journal.student.first_name }} {{ journal.student.last_name }}</span><br>
              <small class="text-muted">ID: {{ journal.student.student_id }}</small>
            </div>
            <div class="col-12 col-md-6">
              <strong>Group:</strong><br>
              <span class="badge bg-secondary fs-6">{{ journal.group.name }}</span>
            </div>
            <div class="col-12 col-md-6">
              <strong>Assignment:</strong><br>
              <span class="fw-bold">{{ journal.group_assignment.title }}</span>
            </div>
            <div class="col-12 col-md-6">
              <strong>Submitted:</strong><br>
              <small class="text-muted">{{ journal.submitted_at.strftime('%m/%d/%Y %I:%M %p') }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-white">
          <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Quick Actions</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{{ url_for('teacher.group_assignment_reflection_journals', assignment_id=journal.group_assignment.id) }}" class="btn btn-primary btn-sm">
              <i class="bi bi-list me-1"></i>View All Journals for Assignment
            </a>
            <form method="POST" action="{{ url_for('teacher.delete_reflection_journal', journal_id=journal.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this reflection journal?')">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                <i class="bi bi-trash me-1"></i>Delete Journal
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ratings Overview -->
  <div class="row g-3 g-md-4 mb-4">
    <div class="col-12 col-md-6">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h4 class="text-{% if journal.collaboration_rating >= 4 %}success{% elif journal.collaboration_rating >= 3 %}warning{% else %}danger{% endif %}">
            {{ journal.collaboration_rating }}/5
          </h4>
          <p class="mb-0">Collaboration Rating</p>
          <div class="progress mt-2" style="height: 10px;">
            <div class="progress-bar bg-{% if journal.collaboration_rating >= 4 %}success{% elif journal.collaboration_rating >= 3 %}warning{% else %}danger{% endif %}" 
                 style="width: {{ (journal.collaboration_rating / 5) * 100 }}%"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h4 class="text-{% if journal.learning_rating >= 4 %}success{% elif journal.learning_rating >= 3 %}warning{% else %}danger{% endif %}">
            {{ journal.learning_rating }}/5
          </h4>
          <p class="mb-0">Learning Rating</p>
          <div class="progress mt-2" style="height: 10px;">
            <div class="progress-bar bg-{% if journal.learning_rating >= 4 %}success{% elif journal.learning_rating >= 3 %}warning{% else %}danger{% endif %}" 
                 style="width: {{ (journal.learning_rating / 5) * 100 }}%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reflection Content -->
  <div class="row g-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-chat-quote me-2"></i>Reflection Text</h5>
        </div>
        <div class="card-body">
          <div class="bg-light p-4 rounded">
            <p class="mb-0" style="white-space: pre-wrap;">{{ journal.reflection_text }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Challenges and Lessons -->
  <div class="row g-4 mt-4">
    {% if journal.challenges_faced %}
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-white">
          <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Challenges Faced</h5>
        </div>
        <div class="card-body">
          <div class="bg-light p-4 rounded">
            <p class="mb-0" style="white-space: pre-wrap;">{{ journal.challenges_faced }}</p>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% if journal.lessons_learned %}
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Lessons Learned</h5>
        </div>
        <div class="card-body">
          <div class="bg-light p-4 rounded">
            <p class="mb-0" style="white-space: pre-wrap;">{{ journal.lessons_learned }}</p>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Rating Interpretation -->
  <div class="row g-4 mt-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Rating Interpretation</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <h6>Collaboration Rating: {{ journal.collaboration_rating }}/5</h6>
              <div class="progress mb-2" style="height: 15px;">
                <div class="progress-bar bg-{% if journal.collaboration_rating >= 4 %}success{% elif journal.collaboration_rating >= 3 %}warning{% else %}danger{% endif %}" 
                     style="width: {{ (journal.collaboration_rating / 5) * 100 }}%"></div>
              </div>
              <p class="small mb-0">
                {% if journal.collaboration_rating >= 4 %}
                  <span class="text-success"><strong>Excellent:</strong> Strong collaboration skills demonstrated</span>
                {% elif journal.collaboration_rating >= 3 %}
                  <span class="text-warning"><strong>Good:</strong> Solid collaboration with room for improvement</span>
                {% else %}
                  <span class="text-danger"><strong>Needs Improvement:</strong> Collaboration skills need development</span>
                {% endif %}
              </p>
            </div>
            <div class="col-12 col-md-6">
              <h6>Learning Rating: {{ journal.learning_rating }}/5</h6>
              <div class="progress mb-2" style="height: 15px;">
                <div class="progress-bar bg-{% if journal.learning_rating >= 4 %}success{% elif journal.learning_rating >= 3 %}warning{% else %}danger{% endif %}" 
                     style="width: {{ (journal.learning_rating / 5) * 100 }}%"></div>
              </div>
              <p class="small mb-0">
                {% if journal.learning_rating >= 4 %}
                  <span class="text-success"><strong>Excellent:</strong> Significant learning achieved</span>
                {% elif journal.learning_rating >= 3 %}
                  <span class="text-warning"><strong>Good:</strong> Good learning with potential for more</span>
                {% else %}
                  <span class="text-danger"><strong>Needs Improvement:</strong> Learning outcomes need enhancement</span>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

